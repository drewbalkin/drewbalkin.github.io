---
title: " Log-Optimal And Risk Neutral Valuation -- The Basics"
---

I am assuming the reader is well-versed in stochastic calculus and knows the foundational results on arbitrage pricing of contingent claims. Those that are familiar are used to the risk-neutral valuation of an option -- that is the options price is just the expected value of its discounted payoff under the risk neutral measure. What I aim to do is illustrate a really nice result that allows one to price the option under the true physical measure. Rather than doing this with the given stochastic discount factor, we do it with a choice of numeraire induced by a portfolio. It turns out that the log-optimal portfolio is the unique portfolio such that the price of a claim is simply the expected value (under the physical measure) of the payout priced in units of log-optimal portfolio value! In other words, the growth of the log-optimal portfolio appropriately discounts for time and risk such that pricing can be done under $\mathbb{P}$!

In this post, we will show that this holds for the typical Black-Scholes-Merton model of the market. Then we will show this result holds for all attainable claims for a general class of market models in [part 2 of this blog topic](./logoptimal2.qmd). This is not in contradiction to the traditional results that shows infinitely many EMM for incomplete markets as the log-optimal numeraire induced pricing corresponds to one of the infinite EMM in this case. 

While finding a consistent way to price attainable claims under $\mathbb{P}$ using the log-optimal portfolio as numeraire is indeed beautiful, we might say "so what? We already know how to price attainable claims!" Well it gets much better. In [part 3 of this blog topic](./logoptimal3.qmd) we go one step further and price claims that are unattainable. You might say this is impossible! Indeed from the perspective of arbitrage pricing, it is impossible, as by definition one cannot hedge an unattainable claim. However, from the perspective of expected utility theory, this does not mean that a given person would not have a desire to allocate to a given claim given the right price. In fact, we will show that if one defines the price of a claim for a given person such that this person is indifferent to owning a small amount of claim at that price, then something spectacular happens: the price of the claim turns out to still be the expected payout (under $\mathbb{P}$) of the claim in units of log-optimal portfolio for all investors even with different (CRRA) risk preferences!

I will say all of this turns out to not be anything new, but not much is said on this topic especially as one adds more and more generality. My derivations are that of my own and are meant to be simple. This was created by my own exploration and personal discovery of these results, and I am presenting my own past excursion in deriving them not knowing they existed in the first place.


# Review

Let us review a couple of things from the standard Black-Scholes model in the simplest case of a single risky asset (or stock). Since this is just for review, we will make things as simple as possible taking a constant risk free rate $r$ for the money market account. The money market account has a price process $(B_t)$ and the stock has a price process $(S_t)$ . The governing dynamics can be understood in terms of total return

$$
\frac{dB_t}{B_t} = rdt, \\
\frac{dS_t}{S_t} = \mu dt + \sigma dW_t.
$$

In terms of portfolios, we think of a portfolio allocation control $\pi_t \in \mathcal{F}_t$, where $\mathcal{F}_t$ is the Filtration generated by the Brownian motion. $\pi_t$ represents the fraction of wealth invested into the stock (and hence $1-\pi_t$ is invested in the money-market. The portfolio value process $(V^\pi_t)$ satisfies that its return is simply the weighted average of the stock return and money-market return which gives

$$
\frac{dV^\pi_t}{V^\pi_t} = \pi_t \frac{dS_t}{S_t} + (1-\pi_t) \frac{dB_t}{B_t}.
$$

This reduces to the controlled dynamical system:

$$
\frac{dV^\pi_t}{V^\pi_t} = [r+\pi_t (\mu-r)] dt + \pi_t \sigma dW_t.
$$

The risk neutral pricing formula can be derived in many ways. One derivation is from the following argument:

-   Find a measure $\mathbb{Q}$ such that $(\frac{S_t}{B_t})$ is a $\mathbb{Q}$ - martingale.

-   Since both $(\frac{S_t}{B_t})$ and $(\frac{B_t}{B_t} = 1)$ are $\mathbb{Q}$ - martingale, it is easy to show that any portfolio $\pi = (\pi_t)$ has a corresponding wealth process $V^\pi$ such that $(V^\pi_t/B_t)$ is also a $\mathbb{Q}$ - martingale.

-   Therefore $\mathbb{E}^\mathbb{Q} \left[ \frac{V^\pi_T}{B_T} \Big| \mathcal{F}_t \right] = \frac{V^\pi_t}{B_t}$ for all portfolios $\pi$.

-   Let $X$ be a time $T$ claim i.e. $X \in \mathcal{F}_t$ is paid out at time $T$. Then (since in this case every claim is attainable), there exists $\pi$ and $V^\pi_0$ such that $V^\pi_T = X$ almost surely. Therefore, from the replication and the $\mathbb{Q}$-martingality of all discounted portfolios, we get the risk neutral pricing formula:

$$\Pi(t;X) =\mathbb{E}^\mathbb{Q} \left[ \frac{X}{B_T/B_t} \Big| \mathcal{F}_t \right]$$

where the function $\Pi(t;\cdot)$ gives the price at time $t$.

For the first point, the measure $\mathbb{Q}$ can be found by finding the measure such that $W^\mathbb{Q}_t := W_t + \frac{\mu-r}{\sigma}t$ is a Brownian motion. Such a measure is guaranteed by the Girsanov theorem by defining $\mathbb{Q}$ by its Radon-Nikodym derivative w.r.t $\mathbb{P}$

$$\frac{d\mathbb{Q}}{d\mathbb{P}} = \exp\left(-\frac{1}{2}\lambda^2(T-t) - \lambda (W_T-W_t)\right) \quad \mathrm{on} \ \mathcal{F}_t,$$ where $\lambda = \frac{\mu-r}{\sigma}$.

For the second point, it is simple to show $(V^\pi_t)$ that is also a $\mathbb{Q}$ - martingale just by examining that $\frac{dV^\pi_t}{V^\pi_t} = \pi_t \frac{dS_t}{S_t} + (1-\pi_t) \frac{dB_t}{B_t}$. Thus since $B$ and $S$ are $\mathbb{Q}$-martingales, hence $\frac{dS_t}{S_t}$ and $\frac{dB_t}{B_t}$ are driftless (in terms of $\mathbb{Q}$ dynamics) and hence so is $\frac{dV^\pi_t}{V^\pi_t}$. Of course you might say it is a local martingale, but if we restrict $\pi$ to a reasonable set of controls we will get that it is a martingale. We aren't too concerned about these details here for this intuitive example.

The rest is immediately evident that our pricing formula holds.

# Continued Review: Pricing Under $\mathbb{P}$.

While the pricing formula under the risk neutral measure is both extremely useful and elegant, it is nice to characterize what the pricing looks like under $\mathbb{P}$ as this illuminates the pricing formula in many ways.

This can be easily done as

$$\mathbb{E}^\mathbb{Q} \left[ \frac{X}{B_T/B_t} \Big| \mathcal{F}_t \right] = \mathbb{E}^\mathbb{P}\left[ \frac{d\mathbb{Q}}{d\mathbb{P}} \frac{X}{B_T/B_t} \Big| \mathcal{F}_t \right].$$ Next, since $\frac{d\mathbb{Q}}{d\mathbb{P}} = \exp\left(-\lambda(T-t) - \frac{1}{2} \lambda^2 (W_T-W_t)\right)$ on $\mathcal{F}_t$, and also using $B_T/B_t = \exp(r(T-t))$, we get

$$\Pi(t;X) =\mathbb{E}^\mathbb{P} \left[ \frac{X}{e^{(r+\lambda)(T-t) + \frac{1}{2} \lambda^2 (W_T-W_t))}} \Bigg| \mathcal{F}_t \right],$$

which is the pricing under $\mathbb{P}$ adjusted with a new factor. What we have done is computed the so-called SDF, stochastic discount factor, explicitly. That is we have found some $m_T \in \mathcal{F}_T$ such that

$$ \Pi(0;X) =\mathbb{E}^\mathbb{P} \left[ m_T X  \right], $$

$$\Pi(t;X) =\mathbb{E}^\mathbb{P} \left[ \frac{m_T}{m_t} X  \Big| \mathcal{F}_t \right]. $$ 

The interpretation is that the price of $X$ is its expected payout weighted by some appropriate kernel that accounts for both time and risk. Such a kernel is called the pricing kernel (or as we said earlier SDF).

So far this is all review. We have computed the SDF explicitly in this case. This is mildly interesting at first glance: we learned the appropriate Kernel in order to price under $\mathbb{P}$. However, on second glance, something more interesting appears. If you are familiar with the Merton problem or the continuous time Kelly Criterion, you may realize that the SDF was actually the recipricol of the so-called log optimal portfolio!

# Big Result

Thus here is the interesting result. The pricing formula is given by

$$ \Pi(t;X) =  \mathbb{E}^\mathbb{P} \left[ \frac{X}{e^{(r+\frac{1}{2}\lambda^2)(T-t) + \lambda (W_T-W_t))}} \Bigg| \mathcal{F}_t \right] = \mathbb{E}^\mathbb{P} \left[ \frac{X}{V^{\pi^*}_T/V^{\pi^*}_t} \Bigg| \mathcal{F}_t \right],$$

where $V^{\pi^*}$ is actually a portfolio given by the constant fraction allocation to stocks at all time: $\pi^*_t = \frac{\mu-r}{\sigma^2} = \frac{\lambda}{\sigma}$.

It turns out this is the so-called log-optimal (aka growth optimal or Kelly optimal) portfolio, which we prove by either directly deriving it or from another tricky argument using Jensen's inequality. But before then, let's just verify it computationally that this corresponding portfolio is indeed the pricing kernel. Then we can show it is also the log-optimal portfolio and give an interpretation to the result!

## Simple verification

We must show that the portfolio $\pi^*_t = \frac{\mu-r}{\sigma^2} = \frac{\lambda}{\sigma}$ produces the portfolio value such that value$\frac{V^{\pi^*}_T}{V^{\pi^*}_t} = e^{(r+\lambda)(T-t) + \frac{1}{2} \lambda^2 (W_T-W_t)}$ This is simple as we have

$$
\frac{dV^{\pi^*}_t}{V^{\pi^*}_t} = [r+\pi^*_t (\mu-r)] dt + \pi^*_t \sigma dW_t.
$$ Now, inputting $\pi^*_t = \frac{\mu-r}{\sigma^2} = \frac{\lambda}{\sigma}$, we see

$$
\frac{dV^{\pi^*}_t}{V^{\pi^*}_t} = (r + \lambda^2) dt + \lambda dW_t.
$$ This is a simple geometric Brownian motion. Solving with the initial value $V^{\pi^*}_t$, we get

$$V^{\pi^*}_T = V^{\pi^*}_t \exp\left( (r + \frac{1}{2} \lambda^2)(T-t) + \lambda (W_T - W_t)\right),$$

and hence the result holds.

## Log optimality of the portfolio

We can show that the portfolio is the so-called log-optimal portfolio in two different ways. Both are easy so we might as well do it here. The first way is a direct construction. First we define the log-optimal portfolio to be the portfolio that maximizes the expected log-utility i.e.

$$ 
\pi^* = \arg \max_{\pi} \mathbb{E} [\log(V^\pi_T)]. 
$$

### Indirect Proof

We already have shown that that the portfolio $\pi^*_t = \frac{\mu-r}{\sigma^2} = \frac{\lambda}{\sigma}$ produces the portfolio value such that value$\frac{V^{\pi^*}_T}{V^{\pi^*}_t} = e^{(r+\lambda)(T-t) + \frac{1}{2} \lambda^2 (W_T-W_t)}$ and thus $$
\Pi(t;X) =   \mathbb{E}^\mathbb{P} \left[ \frac{X}{V^{\pi^*}_T/V^{\pi^*}_t} \Bigg| \mathcal{F}_t \right].
$$ At this point, we don't know that $\pi^*$ is log-optimal, but we know the pricing formula is true from our previous work. Now we let $\pi$ be an arbitrary portfolio. Assume $V^\pi_0 = V^{\pi^*}_0$ meaning that they start with the same initial amount. We have that

$$
\Pi(t;V^\pi_t) = V^\pi_t =   \mathbb{E}^\mathbb{P} \left[ \frac{V^\pi_T}{V^{\pi^*}_T/V^{\pi^*}_t} \Bigg| \mathcal{F}_t \right].
$$ which gives in particular at $t=0$

$$
1  =  \frac{V^\pi_0}{V^{\pi^*}_0} =  \mathbb{E}^\mathbb{P} \left[ \frac{V^\pi_T}{V^{\pi^*}_T} \right].
$$

Now taking $\log(\cdot)$ of both sides, and applying Jensen's inequality, we get

$$    \mathbb{E}^\mathbb{P} \left[ \log \left( \frac{V^\pi_T}{V^{\pi^*}_T}\right)\right] \leq \log \left( \mathbb{E}^\mathbb{P} \left[ \frac{V^\pi_T}{V^{\pi^*}_T} \right] \right)  = 0, $$ and hence we conclude that $$
\mathbb{E}^\mathbb{P} \left[ \log \left( V^\pi_T\right)\right] \leq \mathbb{E}^\mathbb{P} \left[ \log \left( V^{\pi^*}_T\right)\right], \ \forall \pi = (\pi_t)_t.
$$ In otherwords, $\pi^*$ is indeed the log-optimal portfolio.

What we have shown is that if a portfolio has the so-called "numeraire-property" for $\mathbb{P}$, then it is log-optimal. This is a very general result. Here the numeraire property means that it is the choice of numeraire such that every asset becomes a $\mathbb{P}$ martingale in units of this numeraire.

Since our considered portfolio (which we didn't yet know was log-optimal), was known to have the numeraire-property for $\mathbb{P}$, we concluded that it was necessarily log-optimal. Surprisingly, we have proven the exact form of the log-optimal portfolio without even constructing it explicitly!

### Construction

Now we construct the log-optimal portfolio explicitly since it does not require much effort and as a second argument for those not entirely convinced.

A typical approach is to solve the stochastic optimal control problem via the Hamilton-Jacobi-Bellman equation. This is actually overkill for this problem and it is very easy to derive from a direct computation. Simply, lets compute $\mathbb{E} [\log(V^\pi_T)]$ for an arbitrary portfolio $(\pi_t)_t$. We have that for any admissible $(\pi_t)_t$, we have that

$$
\frac{dV^{\pi}_t}{V^{\pi}_t} = [r+\pi_t (\mu-r)] dt + \pi_t \sigma dW_t.
$$ This has the solution

$$V^\pi_T = V^\pi_0\exp \left( \int_0^T [r+\pi_t (\mu-r) - \frac{1}{2} \sigma^2 \pi_t^2 ] dt  + \int_0^T \pi_t \sigma dW_t \right).$$

Taking $\log$ and the expectation, we get:

$$\mathbb{E}[\log(V^\pi_T)] = \log(V^\pi_0) +  \mathbb{E} \left[ \int_0^T [r+\pi_t (\mu-r) - \frac{1}{2} \sigma^2 \pi_t^2 ] dt \right].$$ Now, we seek to maximize the following expression. This may seem non-trivial at first, but carefully inspecting, we see the integrand is just a constant coefficient degree $2$ polynomial in $\pi_t$. This can be maximized point-wise for all $t$ and $\omega$. Maximizing the integrand, we have $\pi_t = \frac{\mu-r}{\sigma^2}$ as claimed.

In case one is suspect of this maximization, we can note that

$$ 
r+ (\mu-r)x  - \frac{1}{2} \sigma^2 x^2   \leq r + (\mu-r) \left( \frac{\mu-r}{\sigma^2} \right)   - \frac{1}{2} \left( \frac{\mu-r}{\sigma^2}
\right)^2, \ \forall x \in \mathbb{R}
$$ by the optimization of a second degree polynomial. Then, since $\pi_t(\omega) \in \mathbb{R}$, the bound holds pointwise for all $t$ and $\omega$, i.e.,

$$ 
r+ (\mu-r)\pi_t(\omega)  - \frac{1}{2} \sigma^2 \pi_t(\omega)^2   \leq r + (\mu-r) \left( \frac{\mu-r}{\sigma^2} \right)   - \frac{1}{2} \left( \frac{\mu-r}{\sigma^2}
\right)^2,
$$

Thus taking integral and expectation over the inequality, we get $$ 
\mathbb{E} \left[ \int_0^T [ r+ (\mu-r)\pi_t(\omega)  - \frac{1}{2} \sigma^2 \pi_t(\omega)^2 ] dt \right]  \leq \mathbb{E} \left[ \int_0^T [ r + (\mu-r) \left( \frac{\mu-r}{\sigma^2} \right)   - \frac{1}{2} \left( \frac{\mu-r}{\sigma^2}\right)^2 ]dt \right].
$$

But since the constant control $\pi_t = \frac{\mu-r}{\sigma^2}$ is admissible (it is a constant control thus it can trivially be decided based on the information at time $t$), we see that the bound is attained.

Thus indeed we have that $\pi_t = \pi^*_t = \frac{\mu-r}{\sigma^2}$ is the log-optimal portfolio.

# Summary

We have shown for this simple Black-Scholes model, that the option pricing for the time $T$ claim $X \in \mathcal{F}_T$ is given by

$$ \frac{\Pi(t;X)}{V^{\pi^*}_t} =  \mathbb{E}^\mathbb{P} \left[ \frac{X}{V^{\pi^*}_T} \Bigg| \mathcal{F}_t \right],$$ where $\pi^* = (\pi^*_t)_t$ is the log-optimal portfolio meaning that it maximizes over all portfolios, the quantity $\mathbb{E}[ \log(V^{\pi^*}_T)]$. This portfolio is also called the growth-optimal portfolio or Kelly optimal as it is the portfolio that satisfies the Kelly criterion. It has a number of wonderful properties, which can be covered later.

The interpretation of the above pricing is as follows: we have the remarkable relation that if the units of measurement were not currency, but instead of growth optimal portfolio value, then the price of an option is just its expected payout under the true measure $\mathbb{P}$! In essence, the right way to adjust for risk and time in considering the options price can be considered simply by having the correct unit of measurement (numeraire) which is the log-optimal portfolio. To understand why this is true, continue reading the other sections of this blog!
