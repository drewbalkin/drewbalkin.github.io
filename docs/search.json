[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "About",
    "section": "",
    "text": "I am Drew Balkin, a PhD student in Mathematics with a deep interest in all things finance. I enjoy mixing the tools and techniques of quantitative finance with the traditional viewpoints of finance on fundamental valuation.\nOne of my personal goals is to use mathematics to model market phenomena based on fundamental principles that will result in a greater understanding of market dynamics."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "kellyoptimalPEtiming.html",
    "href": "kellyoptimalPEtiming.html",
    "title": "Kelly Optimal In Earnings Driven Financial Market",
    "section": "",
    "text": "This post finds a Kelly optimal portfolio allocation depending on PE ratio of an underlying stock index. We assume that the earnings of the index as well as the market multiple are exogenous variables described by SDEs. The earnings of the index are driven by a Geometric Brownian Motion, while the earnings yield is driven by an Ornstein-Uhlenbeck process with parameters determined from historical data. We construct the Kelly optimal portfolio through neural networks as well as analytically showcasing that neural networks can be used to solve similar problems of this form in the case when no analytical solutions exist.\nTo make such a model useful, we will have to construct a more realistic model of how earnings yield / PE ratios drive future prices. The problem with this perspective is that the current earnings level is not the best predictor of future earnings. Because of this, PE ratios can appear artificially low or high as the PE ratio does not demonstrate the actual (probabalistic) future earnings power. However, the model we use assumes that earnings are Markovian in nature and hence valuation is completely understood in terms of the trailing PE ratio (as the distribution of future earnings depends only on the current earnings).\nHowever, we present the general idea for how one can a train long-term portfolio optimization model given some assumed market dynamics."
  },
  {
    "objectID": "logoptimal.html",
    "href": "logoptimal.html",
    "title": "Overview",
    "section": "",
    "text": "Introduction\nWe first introduce a general model and define the growth optimal portfolio associated to it. Such a portfolio can be also called Kelly or log optimal.\nFirst we define \\(S^i_t\\) to be the total return process of asset \\(i\\). This is so that dividends can be ignored. When we have options on the stock price and not the total return process, we can adjust as needed.\nWe start by defining a filtration \\(\\mathcal{F}_t\\) which represents the information in the market up to and including time \\(t\\). We then have\n\\[dS^i_t = \\mu^i_t dt + \\sum_{j=1}^M \\sigma^{i,j}_t dW^j_t.\\] for each \\(i \\in \\{1, \\cdots, N\\}\\) and also \\[dB_t = r_t B_tdt\\] for the money market account.\nIt is important to note that \\(\\mathcal{F}_t\\) is not the filtration generated by the Brownian motion, but one that contains it. \\(\\mu_t\\), \\(\\sigma_t\\), \\(r_t\\) are adapted to the filtration \\(\\mathcal{F_t}\\) – not just the Brownian motion. This means that they can depend on some outside information. This includes for instance, a stochastic volatility model as well as any others.\nThen generality of this model holds from the generality of \\(\\mu_t\\), \\(\\sigma_t\\), and \\(r_t\\). This allows for multiple sources of noise (so for instance we can think of APT models) and stochastic volatility.The model considered (HERE) for instance considers earnings and price to earnings multiple as exogenous processes and the stock price process is determined from these two. This would still fit in to this model. The reason the model maybe unrealistic is that it assumes that we actually do know the local mean rates of returns and volatilities at a given time having observed the information up and to this time.\nNow, we define a portfolio \\(\\pi_t = (\\pi^1_t , \\cdots, \\pi^N_t)\\) which is a process adapted to \\(\\mathcal{F}_t\\). We think of this portfolio in terms of the fraction of wealth allocated to each asset (intuitively: think \\(\\pi_t\\) represents the percentage allocations). The money market allocation will be \\(1 - \\sum_i \\pi^i_t\\), so that way no additional portfolio constraints must be introduced. With this notation, it is very easy to define self financing portfolios. It just corresponds to any choice of \\(\\pi_t = (\\pi^1_t , \\cdots, \\pi^N_t) \\in \\mathbb{R}^N\\) (we may want to choose a bounded set so things do not explode – this corresponds to leverage constraints). The self-financing portfolio associated to \\(\\pi\\), \\(V^\\pi\\), is easily represented in terms of portfolio return:\n\\[\\frac{dV_t^\\pi}{V_t^\\pi} = \\sum_{i=1}^N \\pi^i_t \\frac{dS^i_t}{S^i_t} + (1-\\sum_{i=1}^N \\pi^i_t) r_t dt\\]\nwhich gives\n\\[\\frac{dV_t^\\pi}{V_t^\\pi} = \\pi_t^T \\mu_t dt + \\pi_t^T \\sigma_t dW_t + (1-\\sum_{i=1}^N \\pi^i_t) r_t dt\\]\nwhere \\(\\mu = (\\mu^1 , \\cdots, \\mu^N)\\) and \\(\\sigma = (\\sigma^{i,j})_{i,j}\\). Without loss of generality, we take \\(V_0^\\pi = 1\\) unless stated otherwise.\nWe now can define the log-optimal portfolio as the argument maximizer out of admissible portfolio processes, \\((\\pi_t)\\), of the expression\n\\[\\mathbb{E}[\\log(V_t^\\pi)].\\]\n\n\nTheorems\n\nTheorem 1 Assume that the claim \\(\\xi\\) is attainable. Then its unique arbitrage price is given by \\[\\frac{\\Pi(t ; \\xi)}{V^{\\pi^*}_T} = \\mathbb{E}^{\\mathbb{P}}\\left[ \\frac{\\xi}{V^{\\pi^*}_T} \\bigg{|} \\mathcal{F}_t \\right] \\] That is, the log-optimal portfolio process is the appropriate numeraire such that option pricing is simply the true expected value (under the real world measure \\(\\mathbb{P}\\)!) In other words, if the units of account were simply not dollars, or not bank account, but instead units of log-optimal portfolio, we could simply understand option pricing in the most naive way possible (the expectation of the payout under the true measure)… and it would turn out to be right!\n\nThese results are somewhat known but surprisingly somewhat unknown. Theorem 2 in particular. One can do options pricing without realizing that Theorem 2 provides an alternative method all along for very general models and very general attainable claims.\nLastly, the problem with Theorem 2 is that \\(\\xi\\) needs to be attainable. But what if \\(\\xi\\) is generally unattainable as would be the case for generic claims in a model when \\(M &gt; N\\) for instance when there are more noises than assets. This is a real world setting. However, we can borrow from utility theory. The idea is that although a claim cannot be hedged, its marginal addition to a portfolio would either add or remove utility for a given investor. This investor (identified by their utility function) has a price of the option such that the marginal utility associate with the addition of the option is \\(0\\). This would be the investor’s utility price for the option.\nTo make this more rigorous:\n\n** Definition 1 ** Consider a claim that pays out \\(\\xi_T\\) at time \\(T\\). Let \\((U_\\alpha,T)\\) be the investor’s utility function (indexed by \\(\\alpha\\)) for horizon \\(T\\). This means that the investor selects a portfolio strategy \\(\\pi(\\alpha)\\) such that \\(\\mathbb{E}[ U_\\alpha(V^\\pi_T)]\\) is maximized.\nThen the price \\(\\xi_0(\\alpha)\\), called investor \\((U_\\alpha,T)\\)’s indifference price for a marginal quantity, satisfies: \\[\\frac{d}{d\\epsilon} \\bigg{|}_{\\epsilon = 0} \\mathbb{E}\\bigg[ U_\\alpha \\left( (1-\\epsilon)V^{\\pi(\\alpha)}_T + \\epsilon \\frac{\\xi_T}{\\xi_0(\\alpha)} \\right) \\bigg] = 0.\\]\nThis can be reduced and we write \\[\\xi_0(\\alpha) = \\frac{\\mathbb{E}\\bigg[ U_\\alpha ' \\left( V^{\\pi(\\alpha)}_T \\right) \\xi_T \\bigg]}{\\mathbb{E}\\bigg[ U_\\alpha ' \\left( V^{\\pi(\\alpha)}_T \\right) V^{\\pi(\\alpha)}_T \\bigg] }.\\]\n\nNow we have the very powerful result.\n\nTheorem 2 Let \\((U_\\gamma,T)\\) be the investor’s utility function for time horizon \\(T\\). In this case we take \\(U_\\gamma\\) to be any CRRA utility function \\(U_\\gamma(x) = \\gamma x^\\gamma\\) for \\(\\gamma &lt; 1\\). We claim that \\(\\xi_0(\\gamma)\\) does not depend on \\(\\gamma\\) and moreover,\n\n\\[\\chi_0(\\alpha) = \\chi_0 = \\mathbb{E}^{\\mathbb{P}}\\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\right].\\]"
  },
  {
    "objectID": "logoptimal1.html",
    "href": "logoptimal1.html",
    "title": "Log-Optimal And Risk Neutral Valuation – The Basics",
    "section": "",
    "text": "I am assuming the reader is well-versed in stochastic calculus and knows the foundational results on arbitrage pricing of contingent claims. Those that are familiar are used to the risk-neutral valuation of an option – that is the options price is just the expected value of its discounted payoff under the risk neutral measure. What I aim to do is illustrate a really nice result that allows one to price the option under the true physical measure. Rather than doing this with the given stochastic discount factor, we do it with a choice of numeraire induced by a portfolio. It turns out that the log-optimal portfolio is the unique portfolio such that the price of a claim is simply the expected value (under the physical measure) of the payout priced in units of log-optimal portfolio value! In other words, the growth of wealth process from the log-optimal portfolio appropriately discounts for time and risk such that pricing can be done under \\(\\mathbb{P}\\)!\nIn this post, we will show that this holds for the typical Black-Scholes-Merton model of the market. Then we will show this result holds for all attainable claims for a general class of market models in part 2 of this blog topic.\nWhile finding a consistent way to price attainable claims under \\(\\mathbb{P}\\) using the log-optimal portfolio as numeraire is indeed beautiful, we might say “so what? We already know how to price attainable claims!” Well, in part 3 of this blog topic, we go one step further and price claims that are unattainable. You might say this is impossible! Indeed from the perspective of arbitrage pricing, it is impossible, as by definition one cannot hedge an unattainable claim. However, from the perspective of utility theory, there is a right “price” for each person. In fact, we will show that if one defines the price of a claim for a given person such that this person is indifferent to owning a small amount of claim at that price, then something spectacular happens: the price of the claim turns out to still be the expected payout (under \\(\\mathbb{P}\\)) of the claim in units of log-optimal portfolio for all investors even with different (CRRA) risk preferences! So, from this perspective, pricing under the log-optimal portfolio generalizes option pricing whereby not only are the results consistent with hedgeable claims, but also for those that cannot be hedged as well!\nI will say all of this turns out to not be anything new, but not much is said on this topic especially as one adds more and more generality. My derivations are that of my own and are meant to be simple. This was created by my own exploration and personal rediscovery of these results, and I am presenting my own past excursion in their derivation. My approach is meant to be simple. This means that there will be some simplifying assumptions that make life easier. You will see more on that later."
  },
  {
    "objectID": "logoptimal1.html#simple-verification",
    "href": "logoptimal1.html#simple-verification",
    "title": "Log-Optimal And Risk Neutral Valuation – The Basics",
    "section": "Simple verification",
    "text": "Simple verification\nWe will show that the portfolio \\(\\pi^*_t = \\frac{\\mu-r}{\\sigma^2} = \\frac{\\lambda}{\\sigma}\\) produces the portfolio value such that value\\(\\frac{V^{\\pi^*}_T}{V^{\\pi^*}_t} = e^{(r+\\lambda)(T-t) + \\frac{1}{2} \\lambda^2 (W_T-W_t)}\\), which will prove \\[\\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{V^{\\pi^*}_T/V^{\\pi^*}_t} \\Bigg| \\mathcal{F}_t \\right] = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{e^{(r+\\frac{1}{2}\\lambda^2)(T-t) + \\lambda (W_T-W_t))}} \\Bigg| \\mathcal{F}_t \\right] = \\Pi(t;X)\\] as desired. This is simple manner of substitution as we have:\n\\[\n\\frac{dV^{\\pi^*}_t}{V^{\\pi^*}_t} = [r+\\pi^*_t (\\mu-r)] dt + \\pi^*_t \\sigma dW_t.\n\\] Now, inputting \\(\\pi^*_t = \\frac{\\mu-r}{\\sigma^2} = \\frac{\\lambda}{\\sigma}\\), we see\n\\[\n\\frac{dV^{\\pi^*}_t}{V^{\\pi^*}_t} = (r + \\lambda^2) dt + \\lambda dW_t.\n\\] This is a simple geometric Brownian motion:\n\\[V^{\\pi^*}_T = V^{\\pi^*}_t \\exp\\left( (r + \\frac{1}{2} \\lambda^2)(T-t) + \\lambda (W_T - W_t)\\right),\\]\nand hence the result holds."
  },
  {
    "objectID": "logoptimal1.html#log-optimality-of-the-portfolio",
    "href": "logoptimal1.html#log-optimality-of-the-portfolio",
    "title": "Log-Optimal And Risk Neutral Valuation – The Basics",
    "section": "Log optimality of the portfolio",
    "text": "Log optimality of the portfolio\nWe can show that the portfolio is the so-called log-optimal portfolio in two different ways. I’ll start with my favorite approach which doesn’t involve a direct computation, but uses the fact that we have just shown it to be the pricing kernel. We must find the portfolio \\(\\pi^*\\) such that:\n\\[\n\\pi^* = \\arg \\max_{\\pi} \\mathbb{E} [\\log(V^\\pi_T)].\n\\]\n\nIndirect Proof\nWe already have shown that that the portfolio \\(\\pi^*_t = \\frac{\\mu-r}{\\sigma^2} = \\frac{\\lambda}{\\sigma}\\) produces the portfolio value such that value\\(\\frac{V^{\\pi^*}_T}{V^{\\pi^*}_t} = e^{(r+\\lambda)(T-t) + \\frac{1}{2} \\lambda^2 (W_T-W_t)}\\) and thus \\[\n\\Pi(t;X) =   \\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{V^{\\pi^*}_T/V^{\\pi^*}_t} \\Bigg| \\mathcal{F}_t \\right].\n\\] At this point, we haven’t yet shown this \\(\\pi^*\\) is log-optimal, but we know the pricing formula is true from our previous work. Now we let \\(\\pi\\) be an arbitrary portfolio. Assume \\(V^\\pi_0 = V^{\\pi^*}_0\\) meaning that they start with the same initial amount. By the pricing formula, we can “price” the portfolio:\n\\[\n\\Pi(t;V^\\pi_t) = V^\\pi_t =   \\mathbb{E}^\\mathbb{P} \\left[ \\frac{V^\\pi_T}{V^{\\pi^*}_T/V^{\\pi^*}_t} \\Bigg| \\mathcal{F}_t \\right].\n\\] which gives in particular at \\(t=0\\)\n\\[\n1  =  \\frac{V^\\pi_0}{V^{\\pi^*}_0} =  \\mathbb{E}^\\mathbb{P} \\left[ \\frac{V^\\pi_T}{V^{\\pi^*}_T} \\right].\n\\]\nNow taking \\(\\log(\\cdot)\\) of both sides, and applying Jensen’s inequality, we get\n\\[    \\mathbb{E}^\\mathbb{P} \\left[ \\log \\left( \\frac{V^\\pi_T}{V^{\\pi^*}_T}\\right)\\right] \\leq \\log \\left( \\mathbb{E}^\\mathbb{P} \\left[ \\frac{V^\\pi_T}{V^{\\pi^*}_T} \\right] \\right)  = 0, \\] and hence we conclude that \\[\n\\mathbb{E}^\\mathbb{P} \\left[ \\log \\left( V^\\pi_T\\right)\\right] \\leq \\mathbb{E}^\\mathbb{P} \\left[ \\log \\left( V^{\\pi^*}_T\\right)\\right], \\ \\forall \\pi = (\\pi_t)_t.\n\\] In otherwords, \\(\\pi^*\\) is the log-optimal portfolio!\nWhat we have shown is that if a portfolio has the so-called “numeraire-property” for \\(\\mathbb{P}\\), then it is log-optimal. Here, the “numeraire-property” means that it is the choice of numeraire such that every asset becomes a \\(\\mathbb{P}\\) martingale in units of this numeraire.\nSince our considered portfolio (which we didn’t yet know was log-optimal), was known to have the numeraire-property for \\(\\mathbb{P}\\), we concluded that it was necessarily log-optimal. Surprisingly, we have proven the exact form of the log-optimal portfolio without even constructing it explicitly!\nFor those more interested in this property, we note that this can be generalized to supermartingale numeraires. That is if a portfolio is such that asset prices in units of this numeraire portfolio are all supermartingales, then it is necessarily log-optimal. While in more general settings, a portfolio with the martingale numeraire property may not exist, a portfolio with the supermartingale numeraire property always exist. Moreover, a supermartingale numeraire portfolio must be log-optimal due to this same Jensen’s inequality argument.\n\n\nConstruction\nAnother approach to showing that \\(\\pi^* = \\frac{\\mu-r}{\\sigma^2}\\) gives the log-optimal portfolio is through direct construction. We don’t need to do this since we already have a fun, clever proof, but I have a fun way to do this as well.\nA typical approach is to solve the stochastic optimal control problem via the Hamilton-Jacobi-Bellman equation. This is actually overkill for this problem and it is very easy to derive from a direct computation. Simply, lets compute \\(\\mathbb{E} [\\log(V^\\pi_T)]\\) for an arbitrary portfolio \\((\\pi_t)_t\\). We have that for any admissible \\((\\pi_t)_t\\):\n\\[\n\\frac{dV^{\\pi}_t}{V^{\\pi}_t} = [r+\\pi_t (\\mu-r)] dt + \\pi_t \\sigma dW_t.\n\\] This has the solution\n\\[V^\\pi_T = V^\\pi_0\\exp \\left( \\int_0^T [r+\\pi_t (\\mu-r) - \\frac{1}{2} \\sigma^2 \\pi_t^2 ] dt  + \\int_0^T \\pi_t \\sigma dW_t \\right).\\]\nTaking \\(\\log\\) and the expectation, we get:\n\\[\\mathbb{E}[\\log(V^\\pi_T)] = \\log(V^\\pi_0) +  \\mathbb{E} \\left[ \\int_0^T [r+\\pi_t (\\mu-r) - \\frac{1}{2} \\sigma^2 \\pi_t^2 ] dt \\right].\\] Now, we seek to maximize the above expression. This may seem non-trivial at first, but carefully inspecting, we see the integrand is just a constant coefficient degree \\(2\\) polynomial in \\(\\pi_t\\). This can be maximized pointwise for all \\(t\\) and \\(\\omega\\). Maximizing the integrand, we have \\(\\pi_t = \\frac{\\mu-r}{\\sigma^2}\\) as claimed.\nIn case one is suspect of this maximization, we can note that\n\\[\nr+ (\\mu-r)\\pi_t(\\omega)  - \\frac{1}{2} \\sigma^2 \\pi_t(\\omega)^2   \\leq r + (\\mu-r) \\left( \\frac{\\mu-r}{\\sigma^2} \\right)   - \\frac{1}{2} \\left( \\frac{\\mu-r}{\\sigma^2}\n\\right)^2,\n\\]\nby the optimization of a second degree polynomial as \\(\\pi_t(\\omega) \\in \\mathbb{R}\\), so the bound holds pointwise for all \\(t\\) and \\(\\omega\\).\nThus taking integral and expectation over the inequality, we get \\[\n\\mathbb{E} \\left[ \\int_0^T [ r+ (\\mu-r)\\pi_t(\\omega)  - \\frac{1}{2} \\sigma^2 \\pi_t(\\omega)^2 ] dt \\right]  \\leq \\mathbb{E} \\left[ \\int_0^T [ r + (\\mu-r) \\left( \\frac{\\mu-r}{\\sigma^2} \\right)   - \\frac{1}{2} \\left( \\frac{\\mu-r}{\\sigma^2}\\right)^2 ]dt \\right].\n\\]\nSince \\(\\pi_t = \\frac{\\mu-r}{\\sigma^2}\\) is an admissible portfolio (i.e. an allocation strategy that can actually be put into practice), we see that the bound is attained by this \\(\\pi\\) and hence it is optimal.\nThus, we have that \\(\\pi_t = \\pi^*_t = \\frac{\\mu-r}{\\sigma^2}\\) is the log-optimal portfolio."
  },
  {
    "objectID": "logoptimal3.html",
    "href": "logoptimal3.html",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "",
    "text": "What we will now show is a very interesting result regarding the pricing under the log-optimal numeraire. So far, we have shown for a very general model, that the pricing\n\\[\n\\Pi(t;X) = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{V^{\\pi^*}_T/V^{\\pi^*}_t} \\Bigg| \\mathcal{F}_t \\right]\n\\] holds for all attainable claims \\(X\\) where \\(\\pi^*\\) is the log-optimal portfolio process and \\(V^{\\pi^*}\\) its corresponding portfolio value. This exciting results means that the naive pricing can be done under the physical measure \\(\\mathbb{P}\\) as long as we were denoting everything to be in the “right” units of “currency” (or numeraire) – which happens to be the log-optimal portfolio value.\nAlthough an exciting result, there are two main problems this faces for practical implementation. The first is that it is actually hard to achieve the growth optimal portfolio as one would have to know the local rates of mean return, volatilities (across all differing possible sources of noise), and money market rate – \\(\\mu_t\\), \\(\\sigma_t\\), \\(r_t\\) at each time. Although these values are themselves random, the model we consider (a generalization of Black-Scholes, local volatility, stochastic volatility, and much else) still assumes that at time \\(t\\) we know what those values are at that instant (although we don’t know the resulting shocks due to the noise). Specifying the “ground truth” (random) model is very, very hard in reality!\nWe will not address this first problem that corresponds to its limited viability in reality. Instead we will deal with a secondary problem. What we have shown so far is a pricing for attainable claims. For unattainable claims (ones we cannot hedge), we may still find a derivative (long or short) compelling based on the price. Thus although one cannot hedge the option, one can still assign their personal value to the option. If going long/short the option (at the observed price) can increase the expected utility of their portfolio, then the investor will buy/sell the option.\nUsing utility theory, it is very easy to understand when the investor gains from buying or selling the option. Suppose \\(\\pi\\) is the optimal portfolio (among presently traded securities) for an investor with utility function \\(U\\). All of a sudden, an option \\(\\chi\\) comes on the market. The option will payout \\(\\chi_T\\) at time \\(T\\) and can be bought/sold for \\(\\chi_0\\). Without loss of generality, assume \\(V^\\pi_0 = 1\\). The investor will be interested (in a small amount) of the option if the initial price \\(\\chi_0\\) is such that their expected utility increases by adding a tiny position (long option) to the portfolio. If the option price is such that their expected utility decreases by adding a small amount of long option, then we can show the investor would be interested in the short option position. Thus, we can find the personal price for a given investor of the option as the price such that they are indifferent to adding a small amount of option to their portfolio.\n\nMarginal Utility Indifference Pricing\nWe will now derive the idea of a marginal utility indifference price. This will be the price that an investor with a given utility pays for an infinitesimally small amount of a given claim. We identify the utility of the investor (indexed by gamma) as \\(U_\\gamma(x)\\).\nAssume that an investor currently has an optimal portfolio strategy for their utility function. This gives wealth process \\(V^{\\pi_\\gamma}_T\\). Without loss of generality, assume \\(V^{\\pi_\\gamma}_0 = 1\\).\nNow consider a claim with payout at time \\(T\\), \\(\\chi_T\\). We denote its value (to investor with utility indexed by \\(\\gamma\\)) at time \\(0\\) by \\(\\chi_0(\\gamma)\\).\nAssuming the investor now allocates \\(\\epsilon\\) of their wealth to \\(\\chi\\) and \\((1-\\epsilon)\\) to their original (\\(\\gamma\\) - utility optimal) strategy, then the investor will be indifferent to adding the option if\n\\[\\frac{d}{d\\epsilon} \\Bigg|_{\\epsilon = 0} \\mathbb{E} \\left[ U\\left((1-\\epsilon)V^{\\pi_\\gamma}_T + \\epsilon \\frac{\\chi_T}{\\chi_0}\\right)\\right] = 0.\\]\nWhat this means is that the investor does not gain any expected utility by adding/ removing \\(\\chi\\) to their portfolio. In otherwords, they are indifferent to buying or selling the option. What we notice is that whether the above will hold or not depends on the initial price of the option \\(\\chi_0\\). Thus we call \\(\\chi_0(\\gamma)\\) to be the marginal utility indifference price of the option for investor with risk preference parameter \\(\\gamma\\). We can solve for \\(\\chi_0(\\gamma)\\) by computing the derivative and using the linearity of the expectation. Doing this, we get\n\\[\\chi_0(\\gamma) = \\frac{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) \\chi_T \\right]}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T\\right]},\\]\nwhere the expectation is under \\(\\mathbb{P}\\). We can write this very suggestively as:\n\\[\n\\chi_0(\\gamma) = \\mathbb{E}[ m_T(\\gamma) \\chi_T ]\n\\] by taking \\[m_T(\\gamma) =  \\frac{U'(V^{\\pi_\\gamma}_T)}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T \\right]}.\\]\nThus we have found the natural stochastic discount factor for an investor with a given utility function.\n\n\nLog Utility Indifference Pricing\nConsider an investor with a log utility function. That is\n\\[U_\\gamma(x) = \\log(x),\\] and denote \\(V^{\\pi^*}_T\\) to be the portfolio value for the log utility investor.\nSubstituting \\(U'(V^{\\pi^*}_T) = \\frac{1}{V^{\\pi^*}_T}\\), we will get:\n\\[\n\\chi_0(0) = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\right].\\]\nIn other words, log-utility based investors will price the claim exactly as we have derived before even in the case of non-attainable claims."
  },
  {
    "objectID": "logoptimal3.html#the-computation",
    "href": "logoptimal3.html#the-computation",
    "title": "Log Optimal Numeraire in Incomplete Markets",
    "section": "The computation",
    "text": "The computation\nAs before, we assume the following model for \\(I\\) risk assets driven by \\(J\\) noises so as to get:\n\\[ \\frac{dS^i_t}{S^i_t} = \\mu^i_t dt + \\sum_{j=J}^m \\sigma^{ij}_t dW^j_t\\]\nwith portfolio processes then given by\n\\[\\frac{dV^\\pi_t}{V^\\pi_t} = \\sum_{i=1}^I \\pi^i_t \\frac{dS^i_t}{S^i_t}.\\] Notice how we are temporarily ignoring the money-market allocation and rate \\(r_t\\). Actually, we can assume that we are (temporarily) in units of the cash-account numeraire i.e. everything is priced in units of \\(B_t\\). This can be easily worked out. The main thing is that the asset local mean returns are understood now as \\(\\mu^i_t - r_t\\) (since they are discounted by the bank account). Also, \\((\\pi^i_t)\\) need not add up to \\(1\\) as the remaining amount is taken to be borrowings. If it makes one feel better, one can adjust the model to be the same one from part 2 and carry out the future computations in terms of the model in terms of units of currency and not units of \\(B_t\\).\nAnyway, with this out of the way, we proceed by computing the optimal portfolios for investors with \\(\\gamma\\) risk preference parameter. Actually, we will show that like the log-utility maximization example from part 1, the case of power utility can also be optimized in a very similar fashion in a way that avoids the usual approach of guessing solutions for the HJB equation!\nWe compute:\n\\[d \\log((V^{\\pi_\\gamma}_t)^\\gamma) = \\gamma d \\log(V^{\\pi_\\gamma}_t) =  \\gamma\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} - \\frac{1}{2} \\gamma \\left(\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} \\right)^2.\\]\nThis gives\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T \\gamma \\pi_t^T \\sigma_t d\\vec{W}_t \\right] .\\]\nSo\n\\[\\mathbb{E}[U(V^{\\pi_\\gamma}_T)] = \\mathbb{E}[\\gamma (V^{\\pi_\\gamma}_T)^\\gamma] = \\gamma \\mathbb{E} \\left[ \\exp \\left( \\int_0^T  \\left(  \\gamma \\pi_t^T \\mu_t -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt \\right) \\right].\\]\nSo if \\(Ker(\\sigma_t\\sigma_t^T) = \\varnothing\\) then, we can optimize the integrand pointwise and the optimal portfolio occurs at\n\\[ \\pi^*_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t.\\]\nTo see why optimizing the integrand pointwise holds, define:\n\\[f(\\pi_t(\\omega) , \\omega, t) =  \\gamma \\pi_t(\\omega)^T \\mu_t(\\omega) -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t(\\omega)^T \\sigma_t(\\omega) \\sigma_t^T(\\omega) \\pi_t(\\omega).\\]\nNote that \\(\\gamma &lt; 1\\) and \\(\\sigma \\sigma^T\\) is uniformly strictly positive definite by assumption, so by quadratic optimization, we have that \\(\\pi^*_t(\\omega) = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\) is such that:\n\\[f(\\pi_t(\\omega),\\omega,t) \\leq f(\\pi^*_t(\\omega),\\omega,t), \\quad \\forall (t, \\omega).\\] Hence\n\\[\\mathbb{E} \\left[ e^{\\int_0^T f (\\pi_t(\\omega),\\omega,t) dt} \\right] \\leq \\mathbb{E} \\left[ e^{\\int_0^T f(\\pi^*_t(\\omega),\\omega,t) dt} \\right].\\]\nIn reality, \\(Ker(\\sigma_t\\sigma_t^T) = \\varnothing\\) which corresponds to absence of arbitrage in the underlying assets, and thus we have the unique portfolio strategy for each given risk preference. With everything somewhat explicit, we can easily compute the indifference price\n\\[\\chi_0 = \\frac{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) \\chi_T \\right]}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T\\right]}\\]\nand show it is the same for each \\(\\gamma\\).\nFirst, notice the CRRA utility satisfies \\(U'(V^{\\pi_\\gamma}_T) = \\gamma \\frac{U(V^{\\pi_\\gamma}_T)}{V^{\\pi_\\gamma}_T}\\). This allows us to write:\n\\[\\chi_0 = \\frac{\\mathbb{E} \\left[ U(V^{\\pi_\\gamma}_T) \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right]}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} = \\mathbb{E} \\left[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right].\\]\nFirst\n\\[ V^{\\pi_\\gamma}_T = \\exp \\left[ \\int_0^T\\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T  \\pi_t^T \\sigma_t d\\vec{W}_t \\right] \\]\nwhere \\(\\pi_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\). So we have\n\\[ V^{\\pi_\\gamma}_T = \\exp \\left[ \\int_0^T \\frac{\\frac{1}{2} - \\gamma}{(1-\\gamma)^2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{1}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right] .\\]\nNext\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\frac{\\frac{1}{2} - \\gamma}{(1-\\gamma)^2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{\\gamma}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right] .\\]\nTherefore\n\\[\\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} = \\exp \\left[ \\int_0^T -\\frac{1}{2}\\left(\\frac{\\gamma}{1-\\gamma} \\right)^2 \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{\\gamma}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]\\]\nThus\n\\[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{1}{V^{\\pi_\\gamma}_T}   =   \\exp \\left[ \\int_0^T \\frac{-1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt - \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]\\]\nand hence the indifference price is then:\n\\[\\chi_0 = \\mathbb{E} \\left[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right] = \\mathbb{E} \\left[ \\frac{\\chi_T}{\\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]}  \\right].\\]\nLastly note that the log-optimal portfolio corresponds to\n\\[\\pi^*_t = (\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\] and its corresponding portfolio process is \\(V^{\\pi^*}_T = \\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t \\right]\\).\nThus each CRRA investor has the indifference price:\n\\[\\chi_0 = \\mathbb{E} \\left[ \\frac{\\chi_T}{\\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]}  \\right] = \\mathbb{E} \\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\right],\\]\nEVEN in the case of non-attainable claims."
  },
  {
    "objectID": "logoptimal2.html",
    "href": "logoptimal2.html",
    "title": "Log-Optimal And Risk Neutral Valuation – The General Case",
    "section": "",
    "text": "In part 1, we had derived the result:\n\\[\n\\frac{\\Pi(t,X)}{V^{\\pi^*}_t} = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{V^{\\pi^*}_T} \\bigg| \\mathcal{F}_t\\right],\n\\] that is the time \\(t\\)-price of the attainable claim \\(X\\) in units of log-optimal portfolio value is merely the expected value (under \\(\\mathbb{P}\\)) of the payout of \\(X\\) in units of log-optimal portfolio at the expiration time! In otherwords, the log-optimal portfolio properly discounted for both time and risk such that a naive pricing under the physical measure holds!\nNow, we show this result is actually quite general! We will consider certain general market dynamics for the case of a market with many assets, and we show that all claims that are attainable in this market have an arbitrage pricing formula that is consistent with the above pricing equation!"
  },
  {
    "objectID": "logoptimal2.html#constructing-the-numeraire-portfolio",
    "href": "logoptimal2.html#constructing-the-numeraire-portfolio",
    "title": "Log-Optimal And Risk Neutral Valuation – The General Case",
    "section": "Constructing the numeraire portfolio",
    "text": "Constructing the numeraire portfolio\nWe can try to find such a numeraire portfolio \\(\\tilde{\\pi}\\), i.e. a portfolio such that \\(\\left( V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)_t\\) is a \\(\\mathbb{P}\\) martingale for all portfolios \\(\\pi\\) by demanding that \\(d\\left( V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)\\) is driftless. Equivalently, we require \\(\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}}\\) is driftless. (Note this is the portfolio \\(\\pi\\)’s return in units of \\(V_t^{\\tilde{\\pi}}\\) which will be useful to compute. As a general trick, when working with a portfolio process, it is often easiest to work in terms of its return. When working with a ratio of assets, the ratio represents the price of one in terms of units of the other and thus itself represents a price process. When working with this new price process it is often useful to work in terms of its return.)\nNow let’s construct the numeraire portfolio. We wish to find \\(\\tilde{\\pi}\\) such that for all \\(\\pi\\), we have\n\\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}}\\] is driftless. Hence \\((V_t^\\pi/V_t^{\\tilde{\\pi}})\\) will be a \\(\\mathbb{P}\\) martingale as we have ensured these driftless relative portfolio values are not just local martingales, but martingales by imposing technical requirements and will be proven in Section 2.2.\nFirst, by Ito’s lemma, we have\n\\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} = \\frac{dV^\\pi_t}{V^\\pi_t} - \\frac{dV^\\tilde\\pi_t}{V^\\tilde\\pi_t} +  \\left(\\frac{dV^\\tilde\\pi_t}{V^\\tilde\\pi_t} \\right)^2 - \\frac{dV^\\tilde\\pi_t dV^\\pi_t}{V^\\tilde\\pi_t V^\\pi_t}.\\]\nThe surprising cleanliness of the above equation is due to the fact that we are working with a highly relevant quantity – the return of one portfolio in units of another (or the relative return). Substituting for the portfolio returns and factoring, we have\n\\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} = (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t) dt + \\sigma_t dW_t - \\sigma_t \\sigma_t^T \\tilde{\\pi_t} dt\\right) .\\]\nThus it is driftless if and only if\n\\[ (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t)  - \\sigma_t \\sigma_t^T \\tilde{\\pi_t}\\right) = 0.\\]\nWe need to find a \\(\\tilde{\\pi}\\) such that the above holds for all \\(\\pi\\). This can be done for each \\(t\\). Denote \\(x=\\pi_t\\), \\(y=\\tilde{\\pi}_t\\), \\(b = (\\mu_t - \\vec{1}r_t)\\) and \\(A = \\sigma_t \\sigma_t^T\\). We note that by our original assumptions, \\(A\\) is invertible.\nWe now have the problem find \\(y\\) such that for all \\(x\\) it holds:\n\\[\n(x-y)^T(b-Ay) = 0.\n\\] First, since \\(A\\) is invertible, we can choose \\(y = A^{-1}b\\) and we are done. However, one might wonder about uniqueness. This \\(y\\) is infact unique as the above has to hold for all \\(x\\). We can choose the particular choice \\(x = b - Ay + y\\) which shows that \\(||b-Ay||^2 = 0\\) and hence \\(y = A^{-1}b\\) is the only solution. What this means is that\n\\[\\tilde{\\pi}_t =  (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t)\\] is the only numeraire portfolio.\nThis shows that when the problem is arbitrage free, there exists a unqiue numeraire portfolio \\(\\tilde{\\pi} = (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t)\\). With this portfolio we have, \\(\\left( V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)_t\\) is a \\(\\mathbb{P}\\) martingale for all portfolios \\(\\pi\\) which gives the relation of all portfolios:\n\\[\n\\frac{V^\\pi_t}{V^{\\tilde\\pi}_t} = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{V^\\pi_T}{V^{\\tilde\\pi}_T} \\Bigg| \\mathcal{F}_t \\right]\n\\]\nand hence for all attainable claims \\[\n\\Pi(t;X) = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{X}{V^{\\tilde\\pi}_T/V^{\\tilde\\pi}_t} \\Bigg| \\mathcal{F}_t \\right].\n\\] This portfolio turns out to be the log-optimal portfolio. This is easily seen as taking \\(V^\\pi_0 = V^{\\tilde\\pi}_0\\) (i.e. the portfolio values start with the same initial wealth), we have\n\\[\n1 = \\mathbb{E}^\\mathbb{P} \\left[ \\frac{V^\\pi_T}{V^{\\tilde\\pi}_T} \\right].\n\\]\nTaking log and applying Jensen’s inequality will give that\n\\[\n  \\mathbb{E}^\\mathbb{P} \\left[\\log(V^\\pi_T)\\right] \\leq \\mathbb{E}^\\mathbb{P} \\left[\\log(V^{\\tilde{\\pi}}_T) \\right], \\quad \\forall \\pi,\n\\] hence the numeraire portfolio is the log-optimal portfolio. In our notation, this means that \\(\\tilde{\\pi} = \\pi^*\\)."
  },
  {
    "objectID": "logoptimal1.html#technical-details-an-excuse-for-the-simplicity",
    "href": "logoptimal1.html#technical-details-an-excuse-for-the-simplicity",
    "title": "Log-Optimal And Risk Neutral Valuation – The Basics",
    "section": "Technical Details – An Excuse for the Simplicity",
    "text": "Technical Details – An Excuse for the Simplicity\nIn general, the details of this theory would be quite hard. We will use some results that greatly simplify things."
  },
  {
    "objectID": "index.html#blog-projects-and-research",
    "href": "index.html#blog-projects-and-research",
    "title": "About",
    "section": "Blog Projects and Research",
    "text": "Blog Projects and Research\nIn this blog, I want to highlight some of my thoughts in a more accessible and informal manner. In part, some work is inspired by my academic research such as my blog post on valuation based Kelly optimal portfolios for market cycle investing. Some of the work in this blog is just my own personal excursion into financial math topics of great interest to me that are relatively uncovered in the financial literature. While the results are known if you are willing to dig deep, I show my own derivations of how the log-optimal portfolio can be used in option pricing in a surprisingly general manner (see the “Log Optimal Portfolio and Option Pricing” blog posts part 1, part 2, and part 3).\n\nValuation-based Kelly Optimal Portfolios for Market Cycle Investing\nFrom a rational standpoint, the value of an equity is the cumulative expected value of its discounted payouts (i.e dividends), where the discounting of dividends is not only done with respect to time, but also for its perceived risk. From this point of view, the movement of the market can be decomposed into two key noises:\n\nChange in the (estimated) probability distribution of future dividends.\nChange in the discount factor for future dividends due to both changing interest rates as well as changing risk-preferences.\n\nTherefore, from this rational point of view, market movement is not solely based on pricing in new economic developments, but also due to risk-preferences that vary throughout time. While even this rational view leads to changes in valuation due to changing risk preferences, this does not encapsulate the full reality of the stock market.\nIn reality, the flows into and out of the market are often non-fundamentally driven, i.e. without regard for valuation. While we can assume a large portion of wealth is allocated based on decisions that are more “behavioral” than rational, today’s current market environment is full of non-fundamental flows beyond the “behavioral investor”. Mandated allocation rules (pension funds), forced liquidations / untimely withdrawals (hedge funds), and systematic passive investing (retirement accounts) all contribute to flows that are completely valuation agnostic.\nThese two factors – changing risk preferences and valuation-agnostic investing – may lead to market cycles in valuation.\nAssuming this is true, how should one allocate over time given the existence of these market cycles?\nI offer a very simple model to offer the start of a framework for this question. This model offers a teaching viewpoint for techniques that can be used in more sophisticated models. This work is included in my blog post on Valuation-based Kelly Optimal Portfolios for Market Cycle Investing.\n\n\nLog-Optimal Portfolio and Option Pricing\nTraditionally, financial derivatives are priced as their discounted payout under a risk neutral measure. I was intrigued by an approach that I rediscovered that shows the price of the derivative is actually its payout under the physical measure when a certain unit of account (or numeraire) is considered. Specifically, if one takes as unit of account the so-called “log-optimal portfolio”, then the option’s price is exactly the expected value of the option’s payout under the true physical measure! In other words, pricing a derivative/security/asset in units of log-optimal portfolio naturally discounts for risk and time! Not only is this true, but it can even be extended to more general frameworks.\nWhile the results are known, I want to present this knowledge in a non-technical fashion for someone with a background in mathematical finance in the same way I rediscovered these results. Here are my lecture notes on this topic starting from the basic case of a traditional Black-Scholes model and then to the case for a generalized market model. In fact, we show this framework is even true for a utility based pricing in the case of unattainable claims!"
  },
  {
    "objectID": "index.html#academic-research",
    "href": "index.html#academic-research",
    "title": "About",
    "section": "Academic Research",
    "text": "Academic Research\nAs for my background, I am completing my PhD in mathematics from UC Santa Barbara with a graduation date in September of 2023. In this time, I have studied machine learning methods for solving stochastic optimal control problems and stochastic differential games. You can view some of my papers below.\n\nStochastic Delay Differential Games: Financial Modeling and Machine Learning Algorithms showcases a methodology to solve stochastic delay differential games with machine learning and highlights various financial problems that can be solved with this technique.\nOptimal Policies for a Pandemic: A Stochastic Game Approach and a Deep Learning Algorithm models Covid-19 dynamics in a game theoretic setting whereby an individual region’s policies interact with those of other regions. Deep learning techniques are used to find the Nash equilibrium for this problem. This paper was published in Proceedings of Machine Learning Research vol 145:1–26, 2021 2nd Annual Conference on Mathematical and Scientific Machine Learning.\nPandemic Control, Game Theory, and Machine Learning provides a survey on stochastic control and differential games applied to Covid-19 as well as the deep learning techniques which allows for solutions to these difficult problems. This was featured in the American Mathematical Society (AMS) Notices."
  },
  {
    "objectID": "kellyoptimalPEtiming.html#justification-from-a-general-model",
    "href": "kellyoptimalPEtiming.html#justification-from-a-general-model",
    "title": "Kelly Optimal In Earnings Driven Financial Market",
    "section": "Justification from a General Model",
    "text": "Justification from a General Model\nWe can think of our ownership of a stock at time \\(t\\) as a claim on the future dividends \\((D_s)_{s \\geq t}\\), where the amount \\(D_s ds\\) per share is paid to the stockholder’s over time \\([s,s+ds]\\).Therefore, we can understand the price of the stock as the present value of all future dividends:\n\\[S_t = \\int_t^{\\infty}  \\mathbb{E}^Q [ e^{-r(s-t)} D_s ds ],\\] where \\(Q\\) is the risk-neutral measure. In fact, one might have some objection to the above in that the dividends aren’t themselves hedgeable claims (outside of the corresponding stock which we are trying to price!). This is not really a problem as the above pricing need not arise from an arbitrage pricing arguement (see part 3 of my blog post on indifference pricing with the log-optimal portfolio for instance). What is true is that \\(Q\\) represents the discounting for risk of the dividend streams and hence its existence can be viewed from the markets desired risk preferences.\n\nHowever the risk preferences themselves can change over time. We don’t then need to use irrational behavior to then describe changes in valuation over time.\nMost likely irrational behavior does play an impact. There are natural periods of the famous “irrational exuberance” and pessimism that cause valuations to move throughout time.\n\nEven if this point 2 is more of the case, we can assume the “irrational exuberance” or “pessimism” is modeled by the changing risk preference structure of the market. Thus points 1 and 2 are essentially the same. To emphasize that \\(Q\\) is itself time dependent, we write the expectation under \\(Q\\) instead under the true physical measure \\(P\\) with some time dependent stochastic discount factor \\(m(\\cdot,t)\\). That is\n\\[S_t = \\int_t^{\\infty}  \\mathbb{E}^Q [ e^{-r(s-t)} D_s ds | \\mathcal{F}_t ] =   \\int_t^{\\infty} \\mathbb{E}^P [ m(s,t) D_s ds | \\mathcal{F}_t ]\\] where \\(m(s,t)\\) the stochastic discount factor (decided by market participants at time \\(t\\)) for future payouts at time \\(s\\).\nHow would the SDF change over time? A very general model would be to have the SDF driven by an abstract SDE in a Hilbert space of functions: \\[\ndm(\\cdot,t) = \\mu\\left(t,m(\\cdot,t)\\right)dt + \\sigma\\left(t,m(\\cdot,t)\\right)dW_t\n\\] where \\(W\\) is a Brownian motion over a Hilbert space. Similarly, \\(D_s(t)\\) will represent the random variable associated to the dividend at time \\(s\\) given the filtration \\(\\mathcal{F}_t\\) which could be driven by similar functional SDE dynamics.\nThe problem is that it will be very hard to fit such a model to historical data to try to learn the model. This can be stated simply: I can check the amount paid in dividends in 1930. However, I cannot get the 1930s view on future dividends from historical data. This might be somewhat possible in more recent years due to the options market allowing one to reconstruct the implied distribution \\(Q\\), however it may be hard to extract the \\(Q\\) distribution for the dividend specifically. Maybe a future project?\nWe assume a particular form that will allow us to fit the model to past data. We note that this utterly destroys some of the key realistic aspects of the model and can be blamed for the lack of better performance. This is given in the model below.\n\nModel: Assume the dividend process has the Markovian structure given a Brownian motion \\(W^D\\) of \\(D_s = D_t \\Phi(W^D_{s-t})\\) (One example is a classic GBM). Then we have that \\[S_t =   \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) D_s ds | \\mathcal{F}_t ] = \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) D_t \\Phi(W^D_{s-t} ) ds | \\mathcal{F}_t ]  \\] \\[    = D_t \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) \\Phi(W^D_{s-t} ) ds | \\mathcal{F}_t ] = D_t M_t,\\] where \\(M_t = \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) \\Phi(W^D_{s-t} ) \\, ds | \\mathcal{F}_t ]\\) is the multiple that the market is putting on the current dividend to determine the current stock price. This can always be done artificially. What gives this more meaning is the fact that while \\(m(t,s)\\) does depend on \\((W^D_{u})_{u \\geq t}\\) (this is what makes it a stochastic discount factor after all), it should not depend on the absolute dividend level \\(D_t\\).\n\nThus we have that the stock price (in the case of Markovian dividend dynamics) is given by\n\\[S_t = M_t D_t.\\] We can then understand the stock price behavior given a model for \\(M_t\\) and \\(D_t\\). A model for \\(M_t\\) and \\(D_t\\) can be easily attained from the data as they are directly observed. We can also write \\(S_t = D_t/y_t\\) as we have done before."
  },
  {
    "objectID": "kellyoptimalPEtiming.html#calculation",
    "href": "kellyoptimalPEtiming.html#calculation",
    "title": "Kelly Optimal In Earnings Driven Financial Market",
    "section": "Calculation",
    "text": "Calculation\nWe assume for now that the Brownian motions \\(W^D,W^y\\) are independent although this is not entirely representative of reality. The model parameters \\(\\mu_D,\\sigma_D,\\theta,y_{eq},\\sigma_y\\) will eventually be calibrated to Shiller’s data for SP500 earnings.\nFrom our exogenous dividend and dividend yield processes, we have an endogenous stock price process as \\(S_t = \\frac{D_t}{y_t} = D_t M_t\\). Now we can model our full problem. Let \\(X_t\\) be the investor’s wealth at time and \\(\\pi_t\\) be the fraction of wealth in which the investor invests in the stock index.\nOver time \\([t,t+dt]\\) the investor will receive dividends equal to the amount of \\(\\pi_t X_t y_t dt\\) as they have \\(\\pi_t X_t\\) invested in the stock which has a dividend yield of \\(y_t\\). What is meant by dividend yield here is the instantaneous dividend yield. If \\(t\\) is measured in years where \\(t=1\\) for instance is 1 year, then the annualized dividend yield. The second aspect of P&L over \\([t,t+dt]\\) is given by the change in stock price– the price return. The price return consists of price change due to dividend change (i.e. dividend growth) and also market multiple changes. Simply however, we can calculate it as follows. The stock price return is \\(\\frac{dS_t}{S_t}\\) and \\(\\pi_t X_t\\) is invested in the stock so the P&L from stock price change is given by \\(\\pi_t X_t \\frac{dS_t}{S_t}\\). Adding these two components of P&L together we get that \\(dX_t = \\pi_t X_t y_t dt + \\pi_t X_t \\frac{dS_t}{S_t}\\).\nAnd from Ito’s lemma we have \\[\\frac{dS_t}{S_t} = \\frac{d(D_tM_t)}{D_tM_t} = \\frac{dD_t}{D_t} + \\frac{dM_t}{M_t} + \\frac{dD_t}{D_t}\\frac{dM_t}{M_t}.\\]\nThis gives\n\\[dX_t = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} + \\frac{d(1/y_t)}{1/y_t} + \\frac{dD_t d(1/y_t)}{D_t/y_t} \\right) \\]\nThe last term is \\(0\\) as we assume \\(dW^D_t dW^y_t = 0\\). We note that for some models may want to consider a correlation for these variables, but our main concern is simplicity. Thus we get\n\\[\\frac{dX_t}{X_t} = \\pi_t \\left( y_t dt + \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right) \\]\nThis expression is very intuitive: it says that the components of stock return are dividend yield + dividend growth rate + change in multiple.\nNow, we consider maximizing a utility function given these dynamics. Let’s maximize the utility of terminal wealth for some utility function \\(U\\). We will later choose \\(U\\) to be \\(\\log\\).\n\\[\\begin{align}\ndD_t & = \\mu_D D_t dt + \\sigma_D D_t dW^D_t \\\\\ndy_t & = -\\theta(y_t-y_{eq})dt + \\sigma_y dW^y_t\\\\\ndX_t & = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right)\\\\\n\\end{align}\\]\n\\[\\max_{\\pi} E[U(X_T)]\\]\nfor some utility function \\(U\\). We will consider the Kelly optimal portfolio allocation given by taking \\(U\\) to be \\(\\log(\\cdot)\\)."
  },
  {
    "objectID": "KellyOptimalMarketCycles.html",
    "href": "KellyOptimalMarketCycles.html",
    "title": "Valuation-based Kelly Optimal Portfolios for Market Cycle Investing",
    "section": "",
    "text": "This post finds a Kelly optimal portfolio allocation depending on PE ratio of an underlying stock index. We assume that the earnings of the index as well as the market multiple are exogenous variables described by SDEs. The earnings of the index are driven by a Geometric Brownian Motion, while the earnings yield is driven by a modified Ornstein-Uhlenbeck process with parameters determined from historical data. We construct the Kelly optimal portfolio through neural networks as well as analytically. The impact is two-fold: On one hand we can see how such a portfolio strategy would have done over a long history of SP500 data. On the other hand, and most importantly for future application, we showcase how such a machine learning technique can be used for portfolio optimization and show that it approximates the analytical solution of a given model. This motivates the use of these machine learning techniques to find optimal portfolios for more realistic and sophisticated modeled dynamics.\nTo make such a model useful, we will have to construct a more realistic model of valuation and impact on return. The first thing we could add is to add interest rates in a joint model with PE ratios. Secondly, a key problem with the model on real world performance are periods where the market looks optically cheap or expensive on a PE-basis, but the reality is the market is cheap or expensive for a reason. In the last section, Section 6, we will examine these periods where the suggested optimal portfolio performed poorly and analyze the source of this failure to motivate future work.\nThe main purpose of this post, therefore, is to highlight a methodology for how one can train long-term portfolio optimization model given a model for market dynamics. Future work will include training optimal portfolios against more realistic market models."
  },
  {
    "objectID": "KellyOptimalMarketCycles.html#justification-from-a-general-model",
    "href": "KellyOptimalMarketCycles.html#justification-from-a-general-model",
    "title": "Valuation-based Kelly Optimal Portfolios for Market Cycle Investing",
    "section": "Justification from a General Model",
    "text": "Justification from a General Model\nWe can think of our ownership of a stock at time \\(t\\) as a claim on the future dividends \\((D_s)_{s \\geq t}\\), where the amount \\(D_s ds\\) per share is paid to the stockholder’s over time \\([s,s+ds]\\).Therefore, we can understand the price of the stock as the present value of all future dividends:\n\\[S_t = \\int_t^{\\infty}  \\mathbb{E}^Q [ e^{-r(s-t)} D_s ds ],\\] where \\(Q\\) is the risk-neutral measure. In fact, one might have some objection to the above in that the dividends aren’t themselves hedgeable claims (outside of the corresponding stock which we are trying to price!). This is not really a problem as the above pricing need not arise from an arbitrage pricing arguement (see part 3 of my blog post on indifference pricing with the log-optimal portfolio for instance). What is true is that \\(Q\\) represents the discounting for risk of the dividend streams and hence its existence can be viewed from the markets desired risk preferences.\n\nHowever, the risk preferences themselves can change over time. We don’t then need to use irrational behavior to then describe changes in valuation over time.\nMost likely irrational behavior does play an impact. There are natural periods of the famous “irrational exuberance” and pessimism that cause valuations to move throughout time.\n\nEven if point 2 holds, we can assume the “irrational exuberance” or “pessimism” is modeled by the changing risk preference structure of the market. Thus points 1 and 2 are essentially the same. To emphasize that \\(Q\\) is itself time dependent, we write the expectation under \\(Q\\) instead under the true physical measure \\(P\\) with some time dependent stochastic discount factor \\(m(\\cdot,t)\\). That is\n\\[S_t = \\int_t^{\\infty}  \\mathbb{E}^Q [ e^{-r(s-t)} D_s ds | \\mathcal{F}_t ] =   \\int_t^{\\infty} \\mathbb{E}^P [ m(s,t) D_s ds | \\mathcal{F}_t ]\\] where \\(m(s,t)\\) the stochastic discount factor (decided by market participants at time \\(t\\)) for future payouts at time \\(s\\).\nHow would the SDF change over time? A very general model would be to have the SDF driven by an abstract SDE in a Hilbert space of functions: \\[\ndm(\\cdot,t) = \\mu\\left(t,m(\\cdot,t)\\right)dt + \\sigma\\left(t,m(\\cdot,t)\\right)dW_t\n\\] where \\(W\\) is a Brownian motion over a Hilbert space. Similarly, \\(D_s(t)\\) will represent the random variable associated to the dividend at time \\(s\\) given the filtration \\(\\mathcal{F}_t\\) which could be driven by similar functional SDE dynamics.\nThe problem is that it will be very hard to fit such a model to historical data in order to learn the model parameters. This can be stated simply: I can check the amount paid in dividends in 1930. However, I cannot get the 1930s view on future dividends from historical data. This might be somewhat possible in more recent years due to the options market allowing one to reconstruct the implied distribution \\(Q\\), however it may be hard to extract the \\(Q\\) distribution for the dividend specifically.\nWe assume a particular form that will allow us to fit the model to past data. This destroys some of the key realistic aspects of the market. However, this allows us to have an easier model. This is given in the model below.\n\nModel: Assume the dividend process has the Markovian structure given a Brownian motion \\(W^D\\) of \\(D_s = D_t \\Phi(W^D_{s-t})\\) (One example is a classic GBM). Then we have that \\[S_t =   \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) D_s ds | \\mathcal{F}_t ] = \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) D_t \\Phi(W^D_{s-t} ) ds | \\mathcal{F}_t ]  \\] \\[    = D_t \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) \\Phi(W^D_{s-t} ) ds | \\mathcal{F}_t ] = D_t M_t,\\] where \\(M_t = \\int_t^{\\infty} \\mathbb{E}^P [ m(t,s) \\Phi(W^D_{s-t} ) \\, ds | \\mathcal{F}_t ]\\) is the multiple that the market is putting on the current dividend to determine the current stock price. Removing \\(D_t\\) can always be done artificially. However, we see that \\(M_t\\) itself does not depend on the absolute level of \\(D_t\\). while \\(m(t,s)\\) does depend on \\((W^D_{u})_{u \\geq t}\\) (this is what makes it a stochastic discount factor after all), we see it does not depend on the absolute dividend level \\(D_t\\).\n\nThus we have that the stock price (in the case of Markovian dividend dynamics) is given by\n\\[S_t = M_t D_t.\\] We can then understand the stock price behavior given a model for \\(M_t\\) and \\(D_t\\). A model for \\(M_t\\) and \\(D_t\\) can be easily attained from the data as they are directly observed. We model \\(M_t\\) by equivalently modeling its inverse \\(y_t = \\frac{1}{M_t}\\)."
  },
  {
    "objectID": "KellyOptimalMarketCycles.html#calculation",
    "href": "KellyOptimalMarketCycles.html#calculation",
    "title": "Valuation-based Kelly Optimal Portfolios for Market Cycle Investing",
    "section": "Calculation",
    "text": "Calculation\nWe assume for now that the Brownian motions \\(W^D,W^y\\) are independent although this is not entirely representative of reality. The model parameters \\(\\mu_D,\\sigma_D,\\theta,y_{eq},\\sigma_y\\) will eventually be calibrated to Shiller’s data for SP500 earnings.\nFrom our exogenous dividend and dividend yield processes, we have an endogenous stock price process as \\(S_t = \\frac{D_t}{y_t} = D_t M_t\\). Now we can model our full problem. Let \\(X_t\\) be the investor’s wealth at time and \\(\\pi_t\\) be the fraction of wealth in which the investor invests in the stock index.\nOver time \\([t,t+dt]\\) the investor will receive dividends equal to the amount of \\(\\pi_t X_t y_t dt\\) as they have \\(\\pi_t X_t\\) invested in the stock which has a dividend yield of \\(y_t\\). What is meant by dividend yield here is the instantaneous dividend yield. If \\(t\\) is measured in years where \\(t=1\\) for instance is 1 year, then the annualized dividend yield. The second aspect of P&L over \\([t,t+dt]\\) is given by the change in stock price– the price return. The price return consists of price change due to dividend change and also market multiple changes. Simply however, we can calculate it as follows. The stock price return is \\(\\frac{dS_t}{S_t}\\) and \\(\\pi_t X_t\\) is invested in the stock so the P&L from stock price change is given by \\(\\pi_t X_t \\frac{dS_t}{S_t}\\). Adding these two components of P&L together we get that \\(dX_t = \\pi_t X_t y_t dt + \\pi_t X_t \\frac{dS_t}{S_t}\\).\nAnd from Ito’s lemma we have \\[\\frac{dS_t}{S_t} = \\frac{d(D_tM_t)}{D_tM_t} = \\frac{dD_t}{D_t} + \\frac{dM_t}{M_t} + \\frac{dD_t}{D_t}\\frac{dM_t}{M_t}.\\]\nThis gives\n\\[dX_t = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} + \\frac{d(1/y_t)}{1/y_t} + \\frac{dD_t d(1/y_t)}{D_t/y_t} \\right) \\]\nThe last term is \\(0\\) as we assume \\(dW^D_t dW^y_t = 0\\). We note that for some models may want to consider a correlation for these variables, but our main concern is simplicity. Thus we get\n\\[\\frac{dX_t}{X_t} = \\pi_t \\left( y_t dt + \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right) \\]\nThis expression is very intuitive: it says that the components of stock return are dividend yield + dividend growth (or decay) + change in multiple.\nSuppose an investor has utility function \\(U\\) which will not change for them over the course of their lifetime. That is unlike the market, the investor will not vary his risk preferences through time. We can then consider the utility maximization problem given in terms of a controlled SDE– this is a typical stochastic optimal control problem.\n\\[\\begin{align}\ndD_t & = \\mu_D D_t dt + \\sigma_D D_t dW^D_t \\\\\ndy_t & = -\\theta(y_t-y_{eq})dt + \\sigma_y dW^y_t\\\\\ndX_t & = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right)\\\\\n\\end{align}\\]\n\\[\\max_{\\pi} E[U(X_T)]\\]\nfor some utility function \\(U\\). We will consider the Kelly optimal portfolio allocation given by taking \\(U\\) to be \\(\\log(\\cdot)\\).\n\nComment on the Kelly / Log / Growth Optimal Portfolio\nThe nice thing about the Kelly optimal portfolio \\(\\pi^*\\) (the portfolio that maximizes log-wealth) is that it has the property that \\(P\\left( \\lim_{T \\rightarrow \\infty} \\left(\\frac{V^{\\pi^*}_T}{V^{\\pi}_T}\\right)^{1/T} \\geq 1\\right) = 1\\) for all other portfolios \\(\\pi\\). This is not true just for the Black-Scholes model, but actually fairly generic models (including the one we have introduced above).\nEssentially, this means this portfolio strategy has corresponding wealth processes that almost surely long-term beats any other portfolio.\nThis is indeed a nice property but it doesn’t mean that the Kelly strategy is the right strategy. For example, how long is long-term?\nTo me, the idea of Kelly portfolios is not useful because it is the correct strategy (it definitely depends on each person!), but is a useful base-point for which investors can orient themselves around.\nThe second problem with Kelly portfolios and utility optimization in general is that it provides results that are subject to a great deal of model risk– the idea that the true distribution of future returns is different than the underlying model."
  },
  {
    "objectID": "logoptimal2.html#sec_locmg",
    "href": "logoptimal2.html#sec_locmg",
    "title": "Log-Optimal And Risk Neutral Valuation – The General Case",
    "section": "Martingality of the Driftless Processes (Avoiding the Strict Local MG)",
    "text": "Martingality of the Driftless Processes (Avoiding the Strict Local MG)\nWe used that\n\\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} = (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t) dt + \\sigma_t dW_t - \\sigma_t \\sigma_t^T \\tilde{\\pi_t} dt\\right), \\]\nwhich is driftless when\n\\[ (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t)  - \\sigma_t \\sigma_t^T \\tilde{\\pi_t}\\right) = 0,\\]\nwhich occurs only for\n\\[\\tilde{\\pi}_t =  (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t).\\]\nWith this \\(\\tilde{\\pi}\\), we have that for all \\(\\pi\\)\n\\[\\begin{align}\n\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} & = (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t) dt + \\sigma_t dW_t - \\sigma_t \\sigma_t^T \\tilde{\\pi_t} dt\\right) \\\\\n& = (\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t dW_t.\n\\end{align}\\]\nNow since we are assuming \\(\\mu_t\\), \\(r_t\\), \\(\\sigma_t\\) are uniformly bounded for all \\(t,\\omega\\), and the uniform bound on the positive uniform lower bound for the eigenvalue of \\((\\sigma_t \\sigma_t^T)\\), we get\n\\[||(\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t)|| \\leq ||(\\sigma_t \\sigma_t^T)||^{-1}_{op} ||(\\mu_t - \\vec{1}r_t)|| \\leq K_1.\\]\nSimilarly, since we consider all portfolios of finite leverage, i.e. such that \\(||\\pi_t|| \\leq K\\), we have:\n\\[\n||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t || \\leq K.\n\\] Thus we see that\n\\[\\mathbb{E}\\left[ e^{\\frac{1}{2} \\int_0^T ||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t ||^2 dt} \\right] \\leq \\mathbb{E}\\left[ e^{\\frac{1}{2} K^2 T }\\right] &lt; \\infty,\\]\nThus Novikov’s condition is satisfied and this guarantees that\n\\[\nV_t^\\pi/V_t^{\\tilde{\\pi}} = \\exp \\left( \\frac{1}{2} \\int_0^T ||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t ||^2 dt + \\int_0^T(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t dW_t \\right)\n\\] is a martingale for all \\(t \\in [0,T]\\)."
  },
  {
    "objectID": "KellyOptimalMarketCycles.html#pe-strategy-superior-vs-cape-not-so-fast",
    "href": "KellyOptimalMarketCycles.html#pe-strategy-superior-vs-cape-not-so-fast",
    "title": "Kelly Optimal In Earnings Driven Financial Market",
    "section": "PE Strategy Superior vs CAPE? Not so fast…",
    "text": "PE Strategy Superior vs CAPE? Not so fast…\nOne might look and see that the Kelly strategy that made decisions using the PE ratio outperformed that based on CAPE. This seemed surprising in that PE should be understated and overstated in certain times.\nWhat happened? Well, if we look at the data the PE ratio might be “looking into the future”. It actually isn’t because the decision made at time \\(t\\) is based on the realized earnings as of time \\(t\\). However, the problem is that investors actually don’t know the realized earnings at time \\(t\\) due to the reporting cycle of companies. A hypothetical person with full insider information knows the exact earnings at time \\(t\\). However, it is uncertain if real investors actually have this information.\nSo actually, what if all an investor has is access to the 1 year trailing earnings starting with the realized earnings 3 months ago? Then PE for this investor is estimated from these trailing earnings. Will the PE timing model then outperform that of CAPE?\nLet’s see how it does:\n\n\nCode\nimport pandas as pd\nwith torch.no_grad():\n    df = pd.read_excel('PEdata.xlsx',sheet_name='Sheet1',header=None)\n    PEdata = df[4][5:1805]\n    TotalReturndata = df[5][5:1805]\n    IndexRealE = df[6][5:1805]\n    PE10data = df[8][5:1805]\n    PE1data = df[2][5:1805]\n\n    PE = np.array(PEdata)\n    PE = PE.astype(np.float32)\n    PE = torch.tensor(PE)\n    \n    PE1 = np.array(PE1data)\n    PE1 = PE1.astype(np.float32)\n    PE1 = torch.tensor(PE1)\n\n    PE10 = np.array(PE10data) \n    PE10 = PE10.astype(np.float32)\n    PE10 = torch.tensor(PE10)\n    \n    \n    TR = np.array(TotalReturndata)\n    TR = TR.astype(np.float32)\n    TR = torch.tensor(TR)\n    TR2 = 0*TR\n\n    IndexRealE = np.array(IndexRealE)\n    IndexRealE = IndexRealE.astype(np.float32)\n    IndexRealE = torch.tensor(IndexRealE)\n\n    N_steps = len(TR)\n\n\n    dt = 1/12\n    T = dt*len(TR)\n\n\n    X = np.empty(N_steps,'O')\n    X_PE10 = np.empty(N_steps,'O')\n    X_PE1 = np.empty(N_steps,'O')\n    t = np.empty(N_steps-1,'O')\n    pi_val = np.empty(N_steps,'O')\n    pi_valPE10 = np.empty(N_steps,'O')\n    pi_valPE1 = np.empty(N_steps,'O')\n\n    X[0] = torch.tensor([1.]).unsqueeze(1) #initial condition represents X(0) = 10. Let's just start with $10\n    TR2[0] = 1\n    X_PE10[0] = torch.tensor([1.]).unsqueeze(1)\n    X_PE1[0] = torch.tensor([1.]).unsqueeze(1) \n    y = (1/PE).unsqueeze(1)\n    yPE10 = (1/PE10).unsqueeze(1)\n    yPE1 = (1/PE1).unsqueeze(1)\n\n    for i in range(0,N_steps-1):\n        t[i] = torch.tensor([10.0]).unsqueeze(1) \n        ty = torch.cat((t[i],y[i].unsqueeze(1)),1)\n        tyPE10 = torch.cat((t[i],yPE10[i].unsqueeze(1)),1)\n        tyPE1 = torch.cat((t[i],yPE1[i].unsqueeze(1)),1)\n        \n        pi_val[i] = pi_NN(ty)\n        pi_valPE10[i] = pi_NN(tyPE10)\n        pi_valPE1[i] = pi_NN(tyPE1)\n\n        #Now we do an ODE step\n        r = TR[i+1]/TR[i]-1\n        X[i+1] = X[i] + r*pi_val[i]*X[i]\n        X_PE10[i+1] = X_PE10[i] + r*pi_valPE10[i]*X_PE10[i]\n        X_PE1[i+1] = X_PE1[i] + r*pi_valPE1[i]*X_PE1[i] \n        TR2[i+1] = TR2[i] + 2*r*TR2[i]\n        \n\n\n    t = np.linspace(2021-T,2021,N_steps)\n    \n    x_PE1_tens = torch.Tensor(N_steps)\n    torch.stack(list(X_PE1),out=x_PE1_tens);\n    x_PE1_plt = x_PE1_tens.numpy()\n    x_PE1_plt = x_PE1_plt[:,0,0]\n    \n    pi_tens = torch.Tensor(N_steps-1)\n    torch.stack(list(pi_val[0:-1]),out=pi_tens);\n    pi_plt = pi_tens.numpy()\n    pi_plt = pi_plt[:,0,0]\n\n    plt.figure(1,(8,5.5));\n    plt.title('Real Wealth under PE 1 year trailing timing (yellow) vs CAPE timing (cyan)');\n    plt.plot(t[:],x_PE1_plt/x_PE1_plt[0],'y',\n                 t[:],X_PE10_plt[:]/X_PE10_plt[0],'c');\n    plt.yscale(\"log\");\n    plt.show();\n\n\n\n\n\n\n\nCode\nreturns_PE1_timing = (x_PE1_plt[1:]/x_PE1_plt[0:-1])-1\n    \nreturns_PE10_timing =(X_PE10_plt[1:]/X_PE10_plt[0:-1])-1\n    \n\nsharpe_PE1_timing = np.mean(returns_PE1_timing)/np.std(returns_PE1_timing)\nsharpe_PE10_timing = np.mean(returns_PE10_timing)/np.std(returns_PE10_timing)\nsharpe_SP500 = np.mean(returns_SP500)/np.std(returns_SP500)\n\n#table output\n\nsharpe_ratio_table = {'PE 1yr trailing Timing': (sharpe_PE_timing*np.sqrt(12), np.mean(returns_PE_timing)*12, np.std(returns_PE_timing)*np.sqrt(12)), 'CAPE timing': (sharpe_PE10_timing*np.sqrt(12), np.mean(returns_PE10_timing)*12, np.std(returns_PE10_timing)*np.sqrt(12)), 'SP500': (sharpe_SP500*np.sqrt(12), np.mean(returns_SP500)*12, np.std(returns_SP500)*np.sqrt(12))}\n\nsharpe_table = pd.DataFrame(sharpe_ratio_table.values(), index=sharpe_ratio_table.keys(), columns=['Modified Sharpe', 'Mean Return', 'Volatility'])\n\nprint(sharpe_table)\n\n\n                        Modified Sharpe  Mean Return  Volatility\nPE 1yr trailing Timing         0.530488     0.158237    0.298286\nCAPE timing                    0.477708     0.147098    0.307924\nSP500                          0.547833     0.077775    0.141969"
  },
  {
    "objectID": "KellyOptimalMarketCycles.html#a-problem-and-adjustment-to-the-pe-based-strategy",
    "href": "KellyOptimalMarketCycles.html#a-problem-and-adjustment-to-the-pe-based-strategy",
    "title": "Valuation-based Kelly Optimal Portfolios for Market Cycle Investing",
    "section": "A Problem and Adjustment to the PE-based Strategy",
    "text": "A Problem and Adjustment to the PE-based Strategy\nOne might look and see that the Kelly strategy that made decisions using the PE ratio outperformed that based on CAPE. This seemed surprising in that PE should be understated and overstated in certain times.\nWhat happened? Well, if we look at the data the PE ratio might be “looking into the future”. It actually isn’t because the decision made at time \\(t\\) is based on the realized earnings as of time \\(t\\). However, the problem is that investors actually don’t know the realized earnings at time \\(t\\) due to the reporting cycle of companies. A hypothetical person with full insider information knows the exact earnings at time \\(t\\). However, it is uncertain if real investors actually have this information.\nSo actually, what if all an investor has is access to the 1 year trailing earnings starting with the realized earnings 3 months ago? Assume this investor estimates current PE from these trailing earnings. Will the PE timing model then outperform that of CAPE?\nFrom the plot below, we see this modified PE to take into account the delay in data availability does still perform well keeping up with the CAPE based approach. However, the outperformance vs CAPE is substantially diminished with this adjusted PE.\n\n\nCode\nimport pandas as pd\nwith torch.no_grad():\n    df = pd.read_excel('PEdata.xlsx',sheet_name='Sheet1',header=None)\n    PEdata = df[4][5:1805]\n    TotalReturndata = df[5][5:1805]\n    IndexRealE = df[6][5:1805]\n    PE10data = df[8][5:1805]\n    PE1data = df[2][5:1805]\n\n    PE = np.array(PEdata)\n    PE = PE.astype(np.float32)\n    PE = torch.tensor(PE)\n    \n    PE1 = np.array(PE1data)\n    PE1 = PE1.astype(np.float32)\n    PE1 = torch.tensor(PE1)\n\n    PE10 = np.array(PE10data) \n    PE10 = PE10.astype(np.float32)\n    PE10 = torch.tensor(PE10)\n    \n    \n    TR = np.array(TotalReturndata)\n    TR = TR.astype(np.float32)\n    TR = torch.tensor(TR)\n    TR2 = 0*TR\n\n    IndexRealE = np.array(IndexRealE)\n    IndexRealE = IndexRealE.astype(np.float32)\n    IndexRealE = torch.tensor(IndexRealE)\n\n    N_steps = len(TR)\n\n\n    dt = 1/12\n    T = dt*len(TR)\n\n\n    X = np.empty(N_steps,'O')\n    X_PE10 = np.empty(N_steps,'O')\n    X_PE1 = np.empty(N_steps,'O')\n    t = np.empty(N_steps-1,'O')\n    pi_val = np.empty(N_steps,'O')\n    pi_valPE10 = np.empty(N_steps,'O')\n    pi_valPE1 = np.empty(N_steps,'O')\n\n    X[0] = torch.tensor([1.]).unsqueeze(1) #initial condition represents X(0) = 10. Let's just start with $10\n    TR2[0] = 1\n    X_PE10[0] = torch.tensor([1.]).unsqueeze(1)\n    X_PE1[0] = torch.tensor([1.]).unsqueeze(1) \n    y = (1/PE).unsqueeze(1)\n    yPE10 = (1/PE10).unsqueeze(1)\n    yPE1 = (1/PE1).unsqueeze(1)\n\n    for i in range(0,N_steps-1):\n        t[i] = torch.tensor([10.0]).unsqueeze(1) \n        ty = torch.cat((t[i],y[i].unsqueeze(1)),1)\n        tyPE10 = torch.cat((t[i],yPE10[i].unsqueeze(1)),1)\n        tyPE1 = torch.cat((t[i],yPE1[i].unsqueeze(1)),1)\n        \n        pi_val[i] = pi_NN(ty)\n        pi_valPE10[i] = pi_NN(tyPE10)\n        pi_valPE1[i] = pi_NN(tyPE1)\n\n        #Now we do an ODE step\n        r = TR[i+1]/TR[i]-1\n        X[i+1] = X[i] + r*pi_val[i]*X[i]\n        X_PE10[i+1] = X_PE10[i] + r*pi_valPE10[i]*X_PE10[i]\n        X_PE1[i+1] = X_PE1[i] + r*pi_valPE1[i]*X_PE1[i] \n        TR2[i+1] = TR2[i] + 2*r*TR2[i]\n        \n\n\n    t = np.linspace(2021-T,2021,N_steps)\n    \n    x_PE1_tens = torch.Tensor(N_steps)\n    torch.stack(list(X_PE1),out=x_PE1_tens);\n    x_PE1_plt = x_PE1_tens.numpy()\n    x_PE1_plt = x_PE1_plt[:,0,0]\n    \n    pi_tens = torch.Tensor(N_steps-1)\n    torch.stack(list(pi_val[0:-1]),out=pi_tens);\n    pi_plt = pi_tens.numpy()\n    pi_plt = pi_plt[:,0,0]\n\n    plt.figure(1,(8,5.5));\n    plt.title('Real Wealth under PE 1 year trailing timing (yellow) vs CAPE timing (cyan)');\n    plt.plot(t[:],x_PE1_plt/x_PE1_plt[0],'y',\n                 t[:],X_PE10_plt[:]/X_PE10_plt[0],'c');\n    plt.yscale(\"log\");\n    plt.show();\n\n\n\n\n\n\n\nCode\nreturns_PE1_timing = (x_PE1_plt[1:]/x_PE1_plt[0:-1])-1\n    \nreturns_PE10_timing =(X_PE10_plt[1:]/X_PE10_plt[0:-1])-1\n    \n\nsharpe_PE1_timing = np.mean(returns_PE1_timing)/np.std(returns_PE1_timing)\nsharpe_PE10_timing = np.mean(returns_PE10_timing)/np.std(returns_PE10_timing)\nsharpe_SP500 = np.mean(returns_SP500)/np.std(returns_SP500)\n\n#table output\n\nsharpe_ratio_table = {'PE 1yr trailing Timing': (sharpe_PE1_timing*np.sqrt(12), np.mean(returns_PE1_timing)*12, np.std(returns_PE1_timing)*np.sqrt(12)), 'CAPE timing': (sharpe_PE10_timing*np.sqrt(12), np.mean(returns_PE10_timing)*12, np.std(returns_PE10_timing)*np.sqrt(12)), '100% SP500': (sharpe_SP500*np.sqrt(12), np.mean(returns_SP500)*12, np.std(returns_SP500)*np.sqrt(12))}\n\nsharpe_table = pd.DataFrame(sharpe_ratio_table.values(), index=sharpe_ratio_table.keys(), columns=['Modified Sharpe', 'Mean Return', 'Volatility'])\n\nprint(sharpe_table)\n\n\n                        Modified Sharpe  Mean Return  Volatility\nPE 1yr trailing Timing         0.488017     0.147088    0.301399\nCAPE timing                    0.474236     0.145645    0.307115\n100% SP500                     0.547833     0.077775    0.141969"
  },
  {
    "objectID": "logoptimal2.html#sec-locmg",
    "href": "logoptimal2.html#sec-locmg",
    "title": "Log-Optimal And Risk Neutral Valuation – The General Case",
    "section": "Martingality of the Driftless Processes (Avoiding the Strict Local MG)",
    "text": "Martingality of the Driftless Processes (Avoiding the Strict Local MG)\nIn our proof, we assumed that a driftless process was a martingale. However, we need to be careful here since driftless processes are only local martingales in general. In this case, we will show it is a martingale because of our demanded regularity conditions on our model and admissible portfolios.\nSpecifically, we had that\n\\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} = (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t) dt + \\sigma_t dW_t - \\sigma_t \\sigma_t^T \\tilde{\\pi_t} dt\\right), \\]\nis driftless when\n\\[ (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t)  - \\sigma_t \\sigma_t^T \\tilde{\\pi_t}\\right) = 0,\\]\nwhich occurs only for\n\\[\\tilde{\\pi}_t =  (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t).\\]\nWe will now show this driftless expression is not just a local martingale, but a full martingale.\nWith this \\(\\tilde{\\pi}\\), we have that for all \\(\\pi\\)\n\\[\\begin{align}\n\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}} & = (\\pi_t - \\tilde{\\pi}_t)^T \\left((\\mu_t - \\vec{1}r_t) dt + \\sigma_t dW_t - \\sigma_t \\sigma_t^T \\tilde{\\pi_t} dt\\right) \\\\\n& = (\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t dW_t.\n\\end{align}\\]\nNow since we are assuming \\(\\mu_t\\), \\(r_t\\), \\(\\sigma_t\\) are uniformly bounded for all \\(t,\\omega\\), and the positive uniform lower bound for the eigenvalue of \\((\\sigma_t \\sigma_t^T)\\), we get\n\\[||(\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t)|| \\leq ||(\\sigma_t \\sigma_t^T)||^{-1}_{op} ||(\\mu_t - \\vec{1}r_t)|| \\leq K_1.\\]\nSimilarly, since we consider all portfolios of finite leverage, i.e. we have that \\(||\\pi_t|| \\leq K_2\\) for all \\(t\\), so we have:\n\\[\n||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t || \\leq K.\n\\] Thus we see that\n\\[\\mathbb{E}\\left[ e^{\\frac{1}{2} \\int_0^T ||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t ||^2 dt} \\right] \\leq \\mathbb{E}\\left[ e^{\\frac{1}{2} K^2 T }\\right] &lt; \\infty.\\]\nThis is Novikov’s condition which guarantees that the process satisfying \\[\\frac{d\\left(V_t^\\pi/V_t^{\\tilde{\\pi}} \\right)}{V_t^\\pi/V_t^{\\tilde{\\pi}}}  =  (\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t dW_t\\] i.e.\n\\[\nV_t^\\pi/V_t^{\\tilde{\\pi}} = \\exp \\left( \\frac{1}{2} \\int_0^T ||(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t ||^2 dt + \\int_0^T(\\pi_t - (\\sigma_t \\sigma_t^T)^{-1} (\\mu_t - \\vec{1}r_t) )^T \\sigma_t dW_t \\right)\n\\] is a martingale for all \\(t \\in [0,T]\\)."
  },
  {
    "objectID": "logoptimal3.html#computation-of-the-log-optimal-portfolio",
    "href": "logoptimal3.html#computation-of-the-log-optimal-portfolio",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "Computation of the Log-Optimal Portfolio",
    "text": "Computation of the Log-Optimal Portfolio\nAnyway, with this out of the way, we proceed by computing the optimal portfolios for investors with \\(\\gamma\\) risk preference parameter. Actually, we will show that like the log-utility maximization example from part 1, the case of power utility can also be optimized in a very similar fashion in a way that avoids the usual approach of guessing solutions for the HJB equation!\nWe compute:\n\\[d \\log((V^{\\pi_\\gamma}_t)^\\gamma) = \\gamma d \\log(V^{\\pi_\\gamma}_t) =  \\gamma\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} - \\frac{1}{2} \\gamma \\left(\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} \\right)^2.\\]\nThis gives\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T \\gamma \\pi_t^T \\sigma_t d\\vec{W}_t \\right] .\\]\nSo\n\\[\\mathbb{E}[U(V^{\\pi_\\gamma}_T)] = \\mathbb{E}[\\gamma (V^{\\pi_\\gamma}_T)^\\gamma] = \\gamma \\mathbb{E} \\left[ \\exp \\left( \\int_0^T  \\left(  \\gamma \\pi_t^T \\mu_t -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt \\right) \\right].\\]\nSo if \\(Ker(\\sigma_t\\sigma_t^T) = \\varnothing\\) then, we can optimize the integrand pointwise and the optimal portfolio occurs at\n\\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t.\\]\nTo see why optimizing the integrand pointwise holds, define:\n\\[f(\\pi_t(\\omega) , \\omega, t) =  \\gamma \\pi_t(\\omega)^T \\mu_t(\\omega) -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t(\\omega)^T \\sigma_t(\\omega) \\sigma_t^T(\\omega) \\pi_t(\\omega).\\]\nNote that \\(\\gamma &lt; 1\\) and \\(\\sigma \\sigma^T\\) is uniformly strictly positive definite by assumption, so by quadratic optimization, we have that \\(\\pi^*_t(\\omega) = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\) is such that:\n\\[f(\\pi_t(\\omega),\\omega,t) \\leq f(\\pi^*_t(\\omega),\\omega,t), \\quad \\forall (t, \\omega).\\] Hence\n\\[\\mathbb{E} \\left[ e^{\\int_0^T f (\\pi_t(\\omega),\\omega,t) dt} \\right] \\leq \\mathbb{E} \\left[ e^{\\int_0^T f(\\pi^*_t(\\omega),\\omega,t) dt} \\right].\\]\nNow that we know that the investor with risk preference parameter \\(\\gamma\\) has their optimal portfolio given by \\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\], we call the corresponding wealth process \\(V^{\\pi_\\gamma}\\) and compute the indifference price for this investor:\n\\[\\chi_0(\\gamma) = \\frac{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) \\chi_T \\right]}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T\\right]}\\]\nand show it is the same for each \\(\\gamma\\)."
  },
  {
    "objectID": "logoptimal3.html#computation-of-the-gamma-investors-utility-indifference-price",
    "href": "logoptimal3.html#computation-of-the-gamma-investors-utility-indifference-price",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "Computation of the \\(\\gamma\\)-Investor’s Utility Indifference Price",
    "text": "Computation of the \\(\\gamma\\)-Investor’s Utility Indifference Price\nFirst, notice the CRRA utility satisfies \\(U'(V^{\\pi_\\gamma}_T) = \\gamma \\frac{U(V^{\\pi_\\gamma}_T)}{V^{\\pi_\\gamma}_T}\\). This allows us to write:\n\\[\\chi_0 = \\frac{\\mathbb{E} \\left[ U(V^{\\pi_\\gamma}_T) \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right]}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} = \\mathbb{E} \\left[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right].\\]\nNext,\n\\[ V^{\\pi_\\gamma}_T = \\exp \\left[ \\int_0^T\\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T  \\pi_t^T \\sigma_t d\\vec{W}_t \\right] \\]\nwhere \\(\\pi_t = \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\). So we have\n\\[ V^{\\pi_\\gamma}_T = \\exp \\left[ \\int_0^T \\frac{\\frac{1}{2} - \\gamma}{(1-\\gamma)^2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{1}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right] .\\]\nNext\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\frac{\\frac{1}{2} - \\gamma}{(1-\\gamma)^2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{\\gamma}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right] .\\]\nTherefore, using \\[U(V^{\\pi_\\gamma}_T) = \\gamma (V^{\\pi_\\gamma}_T)^\\gamma \\] and simplifying the coefficients, we have\n\\[\\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} = \\exp \\left[ \\int_0^T -\\frac{1}{2}\\left(\\frac{\\gamma}{1-\\gamma} \\right)^2 \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\frac{\\gamma}{1-\\gamma} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right],\\]\nand thus\n\\[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{1}{V^{\\pi_\\gamma}_T}   =   \\exp \\left[ \\int_0^T \\frac{-1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt - \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right].\\]\nHence the indifference price is then:\n\\[\\chi_0 = \\mathbb{E} \\left[ \\frac{U(V^{\\pi_\\gamma}_T)}{\\mathbb{E} [ U(V^{\\pi_\\gamma}_T)]} \\frac{\\chi_T}{V^{\\pi_\\gamma}_T} \\right] = \\mathbb{E} \\left[ \\frac{\\chi_T}{\\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]}  \\right].\\]\nLastly note that the log-optimal portfolio corresponds to\n\\[\\pi^*_t = (\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\] and its corresponding portfolio process is \\(V^{\\pi^*}_T = \\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t \\right]\\) as we are assuming all initial portfolio values are \\(1\\).\nThus each CRRA investor has the indifference price:\n\\[\\chi_0 = \\mathbb{E} \\left[ \\frac{\\chi_T}{\\exp \\left[ \\int_0^T \\frac{1}{2} \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\mu_t dt + \\int_0^T \\mu_t^T (\\sigma_t \\sigma_t^T)^{-1} \\sigma_t d\\vec{W}_t  \\right]}  \\right] = \\mathbb{E} \\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\right],\\]\neven in the case of non-attainable claims."
  },
  {
    "objectID": "logoptimal3.html#final-remark-a-dynamic-approach",
    "href": "logoptimal3.html#final-remark-a-dynamic-approach",
    "title": "Log Optimal Numeraire in Incomplete Markets",
    "section": "Final Remark – A Dynamic Approach",
    "text": "Final Remark – A Dynamic Approach\nLet \\(\\chi_t\\) be the price of the claim at time \\(t\\) given the above pricing formula. That is \\[\\frac{\\chi_t}{V^{\\pi^*}_t} = \\mathbb{E} \\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\Bigg| \\mathcal{F}_t \\right].\\] Don’t the optimal portfolios then change given this derivative price? How does this affect our above analysis?\nNote that we are saying that \\(\\left(\\frac{\\chi_t}{V^{\\pi^*}_t} \\right)\\) is a martingale. Hence in particular, it must hold \\(\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t}\\) is driftless.\nNow consider a new portfolio that allocates the fraction of wealth \\(\\pi^\\chi_t\\) to the derivative asset \\(\\chi\\) at time \\(t\\) and the remaining \\(1-\\pi^\\chi_t\\) to their traditional portfolio. The return of this new portfolio \\(V^{\\pi^\\chi}\\) in units of original log-optimal portfolio value is:\n\\[\\frac{d(V^{\\pi^\\chi}_t/V^{\\pi^*}_t)}{V^{\\pi^\\chi}_t/V^{\\pi^*}_t} = \\pi^\\chi_t\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t} + (1-\\pi^\\chi_t)\\frac{d(V^{\\pi^*}_t/V^{\\pi^*}_t)}{V^{\\pi^*}_t/V^{\\pi^*}_t} \\] which simply is:\n\\[\\frac{d(V^{\\pi^\\chi}_t/V^{\\pi^*}_t)}{V^{\\pi^\\chi}_t/V^{\\pi^*}_t} = \\pi^\\chi_t\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t}. \\] Therefore \\((V^{\\pi^\\chi}_t/V^{\\pi^*}_t)\\) is also driftless. From this perspective, the log-optimal investor has no desire to allocate to \\(\\chi\\) at this price even in the continuous setting where any allocation strategy can be considered. A simple way to see it is that now the growth of this portfolio (in relative terms) is non-positive and strictly negative if \\(\\pi^\\chi_t \\neq 0\\). Therefore the log-optimal allocation when considering this new asset is therefore \\(\\pi_t^\\chi = 0\\) and hence the log-optimal investor retains their original allocations even when \\(\\chi\\) is available for sale/purchase. The same holds for the CRRA investors."
  },
  {
    "objectID": "logoptimal3.html#final-remark-a-dynamic-viewpoint",
    "href": "logoptimal3.html#final-remark-a-dynamic-viewpoint",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "Final Remark – A Dynamic Viewpoint",
    "text": "Final Remark – A Dynamic Viewpoint\nIn the derivation of indifference portfolios, we were essentially assuming that the investor would consider a new (rebalanced portfolio) of \\(\\epsilon\\) in the option and \\((1-\\epsilon)\\) in the original portfolio. However, what if we want to consider arbitrary strategies? Couldn’t that effect the pricing? Not really if we take the pricing as is. For example:\nLet \\(\\chi_t\\) be the price of the claim at time \\(t\\) given the above pricing formula. That is \\[\\frac{\\chi_t}{V^{\\pi^*}_t} = \\mathbb{E} \\left[ \\frac{\\chi_T}{V^{\\pi^*}_T} \\Bigg| \\mathcal{F}_t \\right].\\]\nNote that we are saying that \\(\\left(\\frac{\\chi_t}{V^{\\pi^*}_t} \\right)\\) is a martingale. Hence in particular, it must hold \\(\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t}\\) is driftless.\nNow consider a new portfolio of a log-optimal investorthat allocates the fraction of wealth \\(\\pi^\\chi_t\\) to the derivative asset \\(\\chi\\) at time \\(t\\) and the remaining \\(1-\\pi^\\chi_t\\) to their old log-optimal portfolio in terms of the original assets. The relative return of this new portfolio value \\(V^{\\pi^\\chi}\\) in units of original log-optimal portfolio value is:\n\\[\\frac{d(V^{\\pi^\\chi}_t/V^{\\pi^*}_t)}{V^{\\pi^\\chi}_t/V^{\\pi^*}_t} = \\pi^\\chi_t\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t} + (1-\\pi^\\chi_t)\\frac{d(V^{\\pi^*}_t/V^{\\pi^*}_t)}{V^{\\pi^*}_t/V^{\\pi^*}_t} \\] which simply is:\n\\[\\frac{d(V^{\\pi^\\chi}_t/V^{\\pi^*}_t)}{V^{\\pi^\\chi}_t/V^{\\pi^*}_t} = \\pi^\\chi_t\\frac{d(\\chi_t/V^{\\pi^*}_t)}{\\chi_t/V^{\\pi^*}_t}. \\] Therefore \\((V^{\\pi^\\chi}_t/V^{\\pi^*}_t)\\) is also driftless. From this perspective, the log-optimal investor has no desire to allocate to \\(\\chi\\) at this price even in this setting where any time dependent allocation strategy can be considered. A simple way to see it this is that now that the (relative) growth of this portfolio is non-positive and strictly negative if \\(\\pi^\\chi_t \\neq 0\\). Therefore the log-optimal allocation when considering this new asset is therefore \\(\\pi_t^\\chi = 0\\) and hence the log-optimal investor retains their original allocations even when \\(\\chi\\) is available for sale/purchase. The same holds for the CRRA investors."
  },
  {
    "objectID": "logoptimal3.html#computation-of-the-optimal-portfolios",
    "href": "logoptimal3.html#computation-of-the-optimal-portfolios",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "Computation of the Optimal Portfolios",
    "text": "Computation of the Optimal Portfolios\nAnyway, with this out of the way, we proceed by computing the optimal portfolios for investors with \\(\\gamma\\) risk preference parameter. Actually, we will show that like the log-utility maximization example from part 1, the case of power utility can also be optimized in a very similar fashion in a way that avoids the usual approach of guessing solutions for the HJB equation!\nWe compute:\n\\[d \\log((V^{\\pi_\\gamma}_t)^\\gamma) = \\gamma d \\log(V^{\\pi_\\gamma}_t) =  \\gamma\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} - \\frac{1}{2} \\gamma \\left(\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} \\right)^2.\\]\nThis gives\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T \\gamma \\pi_t^T \\sigma_t d\\vec{W}_t \\right] .\\]\nSo\n\\[\\mathbb{E}[U(V^{\\pi_\\gamma}_T)] = \\mathbb{E}[\\gamma (V^{\\pi_\\gamma}_T)^\\gamma] = \\gamma \\mathbb{E} \\left[ \\exp \\left( \\int_0^T  \\left(  \\gamma \\pi_t^T \\mu_t -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt \\right) \\right].\\]\nSo if \\(Ker(\\sigma_t\\sigma_t^T) = \\varnothing\\) then, we can optimize the integrand pointwise and the optimal portfolio occurs at\n\\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t.\\]\nTo see why optimizing the integrand pointwise holds, define:\n\\[f(\\pi_t(\\omega) , \\omega, t) =  \\gamma \\pi_t(\\omega)^T \\mu_t(\\omega) -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t(\\omega)^T \\sigma_t(\\omega) \\sigma_t^T(\\omega) \\pi_t(\\omega).\\]\nNote that \\(\\gamma &lt; 1\\) and \\(\\sigma \\sigma^T\\) is uniformly strictly positive definite by assumption, so by quadratic optimization, we have that \\(\\pi^*_t(\\omega) = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\) is such that:\n\\[f(\\pi_t(\\omega),\\omega,t) \\leq f(\\pi^*_t(\\omega),\\omega,t), \\quad \\forall (t, \\omega).\\] Hence\n\\[\\mathbb{E} \\left[ e^{\\int_0^T f (\\pi_t(\\omega),\\omega,t) dt} \\right] \\leq \\mathbb{E} \\left[ e^{\\int_0^T f(\\pi^*_t(\\omega),\\omega,t) dt} \\right].\\]\nNow that we know that the investor with risk preference parameter \\(\\gamma\\) has their optimal portfolio given by \\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\], we call the corresponding wealth process \\(V^{\\pi_\\gamma}\\) and compute the indifference price for this investor:\n\\[\\chi_0(\\gamma) = \\frac{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) \\chi_T \\right]}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T\\right]}\\]\nand show it is the same for each \\(\\gamma\\)."
  },
  {
    "objectID": "logoptimal3.html#computation-of-the-gamma-optimal-portfolio",
    "href": "logoptimal3.html#computation-of-the-gamma-optimal-portfolio",
    "title": "Log-Optimal Numeraire for Unattainable Claims",
    "section": "Computation of the \\(\\gamma\\)-Optimal Portfolio",
    "text": "Computation of the \\(\\gamma\\)-Optimal Portfolio\nAnyway, with this out of the way, we proceed by computing the optimal portfolios for investors with \\(\\gamma\\) risk preference parameter. Actually, we will show that like the log-utility maximization example from part 1, the case of power utility can also be optimized in a very similar fashion in a way that avoids the usual approach of guessing solutions for the HJB equation!\nWe compute:\n\\[d \\log((V^{\\pi_\\gamma}_t)^\\gamma) = \\gamma d \\log(V^{\\pi_\\gamma}_t) =  \\gamma\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} - \\frac{1}{2} \\gamma \\left(\\frac{dV^{\\pi_\\gamma}_t}{V^{\\pi_\\gamma}_t} \\right)^2.\\]\nThis gives\n\\[ (V^{\\pi_\\gamma}_T)^\\gamma = \\exp \\left[ \\int_0^T \\gamma \\left(  \\pi_t^T \\mu_t -   \\frac{1}{2} \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt + \\int_0^T \\gamma \\pi_t^T \\sigma_t d\\vec{W}_t \\right] .\\]\nas we are assuming all portfolio values are initial \\(1\\). Multiplying by \\(\\gamma\\) and taking expectation, we get:\n\\[\\mathbb{E}[U(V^{\\pi_\\gamma}_T)] = \\mathbb{E}[\\gamma (V^{\\pi_\\gamma}_T)^\\gamma] = \\gamma \\mathbb{E} \\left[ \\exp \\left( \\int_0^T  \\left(  \\gamma \\pi_t^T \\mu_t -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t^T \\sigma_t \\sigma_t^T \\pi_t \\right) dt \\right) \\right].\\]\nSince \\((\\sigma_t\\sigma_t^T)\\) is invertible (this holds for arbitrage free models), we can optimize the integrand pointwise and the optimal portfolio occurs at\n\\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t.\\]\nTo see why optimizing the integrand pointwise holds, define:\n\\[f(\\pi_t(\\omega) , \\omega, t) =  \\gamma \\pi_t(\\omega)^T \\mu_t(\\omega) -   (\\frac{1}{2}\\gamma - \\frac{1}{2}\\gamma^2)  \\pi_t(\\omega)^T \\sigma_t(\\omega) \\sigma_t^T(\\omega) \\pi_t(\\omega).\\]\nNote that \\(\\gamma &lt; 1\\) and \\(\\sigma \\sigma^T\\) is uniformly strictly positive definite by assumption, so by quadratic optimization, we have that \\(\\pi^*_t(\\omega) = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t\\) is such that:\n\\[f(\\pi_t(\\omega),\\omega,t) \\leq f(\\pi^*_t(\\omega),\\omega,t), \\quad \\forall (t, \\omega).\\] Hence\n\\[\\mathbb{E} \\left[ e^{\\int_0^T f (\\pi_t(\\omega),\\omega,t) dt} \\right] \\leq \\mathbb{E} \\left[ e^{\\int_0^T f(\\pi^*_t(\\omega),\\omega,t) dt} \\right].\\]\nNow that we know that the investor with risk preference parameter \\(\\gamma\\) has their optimal portfolio given by\n\\[ \\pi^{\\gamma,*}_t = \\frac{1}{1-\\gamma}(\\sigma_t \\sigma_t^T)^{-1} \\mu_t.\\]\nNow, we call the corresponding wealth process \\(V^{\\pi_\\gamma}\\) and compute the indifference price for this investor:\n\\[\\chi_0(\\gamma) = \\frac{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) \\chi_T \\right]}{\\mathbb{E} \\left[ U'(V^{\\pi_\\gamma}_T) V^{\\pi_\\gamma}_T\\right]}\\]\nand show it is the same for each \\(\\gamma\\)."
  },
  {
    "objectID": "KellyOptimalMarketCycles.html#calculation-of-total-return-process-under-model",
    "href": "KellyOptimalMarketCycles.html#calculation-of-total-return-process-under-model",
    "title": "Valuation-based Kelly Optimal Portfolios for Market Cycle Investing",
    "section": "Calculation of Total Return Process under Model",
    "text": "Calculation of Total Return Process under Model\nRecall our assumed model for the dividends and dividend yield of the stock index is given by:\n\\[\\begin{align}\ndD_t = \\mu_D D_t dt + \\sigma_D D_t dW^D_t, \\\\\ndy_t = -\\theta(y_t-y_{eq})dt + \\sigma_y dW^y_t.\n\\end{align}\\]\nWe assume for now that the Brownian motions \\(W^D,W^y\\) are independent although this is not entirely representative of reality. The model parameters \\(\\mu_D,\\sigma_D,\\theta,y_{eq},\\sigma_y\\) will eventually be calibrated to Shiller’s data for SP500 earnings.\nFrom our exogenous dividend and dividend yield processes, we have an endogenous stock price process as \\(S_t = \\frac{D_t}{y_t} = D_t M_t\\). Now we can model our full problem. Let \\(X_t\\) be the investor’s wealth at time and \\(\\pi_t\\) be the fraction of wealth in which the investor invests in the stock index.\nOver time \\([t,t+dt]\\) the investor will receive dividends equal to the amount of \\(\\pi_t X_t y_t dt\\) as they have \\(\\pi_t X_t\\) invested in the stock which has a dividend yield of \\(y_t\\). What is meant by dividend yield here is the instantaneous dividend yield. If \\(t\\) is measured in years where \\(t=1\\) for instance is 1 year, then the annualized dividend yield. The second aspect of P&L over \\([t,t+dt]\\) is given by the change in stock price– the price return. The price return consists of price change due to dividend change and also market multiple changes. Simply however, we can calculate it as follows. The stock price return is \\(\\frac{dS_t}{S_t}\\) and \\(\\pi_t X_t\\) is invested in the stock so the P&L from stock price change is given by \\(\\pi_t X_t \\frac{dS_t}{S_t}\\). Adding these two components of P&L together we get that \\(dX_t = \\pi_t X_t y_t dt + \\pi_t X_t \\frac{dS_t}{S_t}\\).\nAnd from Ito’s lemma we have \\[\\frac{dS_t}{S_t} = \\frac{d(D_tM_t)}{D_tM_t} = \\frac{dD_t}{D_t} + \\frac{dM_t}{M_t} + \\frac{dD_t}{D_t}\\frac{dM_t}{M_t}.\\]\nThis gives\n\\[dX_t = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} + \\frac{d(1/y_t)}{1/y_t} + \\frac{dD_t d(1/y_t)}{D_t/y_t} \\right) \\]\nThe last term is \\(0\\) as we assume \\(dW^D_t dW^y_t = 0\\). We note that for some models may want to consider a correlation for these variables, but our main concern is simplicity. Thus we get\n\\[\\frac{dX_t}{X_t} = \\pi_t \\left( y_t dt + \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right) \\]\nThis expression provides an intuitive understanding of stock return, which consists of three components: dividend yield, dividend growth (or decay), and changes in the multiple.\nSuppose an investor has utility function \\(U\\) which will not change for them over the course of their lifetime. That is unlike the market, the investor will not vary his risk preferences through time. We can then consider the utility maximization problem given in terms of a controlled SDE, i.e. this is simply a typical stochastic optimal control problem of the form:\n\\[\\begin{align}\ndD_t & = \\mu_D D_t dt + \\sigma_D D_t dW^D_t, \\\\\ndy_t & = -\\theta(y_t-y_{eq})dt + \\sigma_y dW^y_t,\\\\\ndX_t & = \\pi_t X_t \\left( y_t dt +  \\frac{dD_t}{D_t} +  \\frac{d(1/y_t)}{1/y_t} \\right),\\\\\n\\end{align}\\]\n\\[\\pi^* = \\arg \\max_{\\pi} E[U(X_T)],\\]\nfor some utility function \\(U\\). We will consider the portfolio allocation that maximizes long-term growth rate, often known as the Kelly criterion, by taking \\(U\\) to be \\(\\log(\\cdot)\\).\n\nComment on the Kelly / Log / Growth Optimal Portfolio\nOne appealing feature of the Kelly-optimal portfolio \\(\\pi^*\\) (i.e. that which maximizes log-wealth) is that given any other portfolio \\(\\pi\\), the CAGR of the Kelly-optimal portfolio \\(\\pi^*\\) will be larger than that \\(\\pi\\) given a long enough time horizon. To state this formally, we have that \\(P\\left( \\lim{T \\rightarrow \\infty} \\left(\\frac{V^{\\pi^*}_T}{V^{\\pi}_T}\\right)^{1/T} \\geq 1\\right) = 1\\). The reason being is that due to time averaging, the realized CAGR will approach the expected CAGR– which was maximized for this given portfolio. This is not true just for the Black-Scholes model for stock dynamics, but holds for fairly generic models including the one we have introduced above.\nThis is indeed is a nice property, but it doesn’t mean that the Kelly strategy is the right strategy. For example, how long is long-term?\nTo me, the idea of Kelly portfolios is not useful because it is the correct strategy (it definitely depends on each person what a correct strategy would be!), but is a useful base-point for which investors can orient themselves around.\nThe second problem with Kelly portfolios and utility optimization in general is that it provides results that are subject to a great deal of model risk– that is risk that arises from the fact that the true distribution of future returns is different than that assumed by the underlying model. The model risk of our assumed model will be evident when it is tested on actual SP500 data. See Section 6 to see particular periods where the Kelly portfolio failed miserably. In essence, this section is a commentary on the realization of (downside) model risk."
  }
]