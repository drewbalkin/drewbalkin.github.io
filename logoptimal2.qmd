---
title: " Log-Optimal And Risk Neutral Valuation -- The General Case"
---

# Problem Set-up
- We consider $I$ assets whose price dynamics are affected by $J$ noises. In reality, $J>>I$ as there are many more noises than assets.

- Stock $i$'s dynamics are given by

$$ 
\frac{dS^i_t}{S^i_t} = \mu^i_t dt + \sum_{j=1}^J \sigma^{ij}_t dW^j_t
$$

- $\mu^i_t$ is the mean rate of return of stock $i$ which itself is stochastic. 

- $\sigma^{ij}_t$ is the volatility of stock $i$ associated to the noise $j$.It itself is also potentially stochastic. 

- Lastly there is an interest rate $r_t$ for a money-market account (which is also stochastic) and such that 

- We will use the notation $\sigma_t = (\sigma^{ij}_t)$ and $\mu_t = (\mu^1_t, \cdots, \mu^I_t)$.

- To be precise, we have $\sigma_t,r_t,\mu_t$ are all $\mathcal{F}_t$-adapted where $\mathcal{F}_t$ is the sigma algebra generated by the Brownian motion $W_t = (W^1_t, \cdots, W^J_t)$. At first this seems restrictive, we would want them to be general. However, this includes many such models. At first glance, one might not think stochastic volatility, for example, is included in this model as the volatility is not adapted to the Brownian motion of the stock! However, for stochastic volatility, we would merely need to do $\frac{dS_t}{S_t} = \mu dt + \sigma_t dW^1_t + 0 dW^2_t$ and $\sigma_t$'s dynamics are given in terms of $W^2_t$. Thus it is not adapted to the "Brownian motion" of the stock, but it is $\mathcal{F}_t$ adapted which allows us to do stochastic integration etc.. Thus actually the condition that $\sigma_t,r_t,\mu_t$ are all $\mathcal{F}_t$-adapted can lead to very broad models and we will examine just a few toward the end.

- Now we consider a portfolio which invests the fraction of wealth $\pi^i_t$ into stock $i$ at time $t$. We require $\pi^i_t$ be $\mathcal{F}_t$-adapted and bounded. We also require that  $\sigma_t,r_t,\mu_t$ are defined such that $S^i_t$, $e^{\int_0^T r_s ds}$ are bounded and the covariance matrix $(\sigma_t\sigma_t^T)$ is non-singular and that its minimal eigenvalue is uniformly bounded (for all $t$) by some $\epsilon > 0$ as well as its maximal eigenvalue be uniformly bounded from above . Then taking portfolio processes such that $|\pi_t| \leq K$ for all $t$, we have that all $\mathbb{Q}$ - local martingale portfolio values are actually $\mathbb{Q}$-martingales. Then by the eigenvalue bounds on the covariance matrix, one will see that the log-optimal portfolio is also such that $|\pi^*_t| \leq K$ for all $t$. This formalizes our approach below.

We say $\pi = (\pi^1, \cdots, \pi^I)$ and $1 - \pi_t^T \vec{1}$ is invested into the money market at time $t$. Note that we do not distinguish vectors and scalars with a notation other than the case with $1$ vs $\vec{1}$.

- The portfolio process associated to $\pi$ we call $V^\pi_t$ and it is described through its return:

$$
\frac{dV^\pi_t}{V^\pi_t} = \sum_{i=1}^n \pi^i_t \frac{dS^i_t}{S^i_t} + (1 - \pi_t^T \vec{1})r_t dt,
$$
which can be written as

$$
\frac{dV^\pi_t}{V^\pi_t} = [r_t + \pi_t^T(\mu_t - \vec{1}r_t)]dt +  \pi_t^T \sigma_t dW_t.
$$

# Numeraire Portfolio

We now wish to price any attainable time $T$ claim $X$. We know that since $(\sigma_t\sigma_t^T)$ is invertible, we have no arbitrage. From the standard theory, we do not have attainability of any claim (as $J > I$), but we can price any attainable claim $X$ with any choice of the infinitely many risk neutral measures $\mathbb{Q}$. The result is
$$
\Pi(t;X) = \mathbb{E}^\mathbb{Q} \left[ \frac{X}{B_T/B_t} \Big| \mathcal{F}_t \right]
$$
where $(B_t)$ is the price process associated to a $100\%$ money-market allocation, i.e. $\frac{dB_t}{B_t} = r_t dt$. This holds where $\mathbb{Q}$ is a measure such that $\frac{S^i_t}{B_t}$ are $\mathbb{Q}$-martingales for all $i \in \{1, \cdots, I\}$. The reasoning is that since all stocks and bonds are $\mathbb{Q}$-martingales, it is easy to show that any portfolio is also a $\mathbb{Q}$-martingales and hence any attainable claim is a $\mathbb{Q}$-martingale. 

Thus given a model, in order to price attainable claims, one would have to construct a $\mathbb{Q}$ such that all stocks are $\mathbb{Q}$ martingales.

There is a secondary approach, however. What if instead of finding a measure $\mathbb{Q}$ (one of infinitely many) such that all portfolio values are $\mathbb{Q}$-martingales, what if we instead find a numeraire such that all portfolio values or $\mathbb{P}$ martingales with respect to this numeraire? Of course such a numeraire exists as it correpsonds to any of the EMMs $\mathbb{Q}$. However, what if there exists a numeraire that is the wealth process associated to a portfolio $\tilde{\pi}$? If such a portfolio $\tilde{\pi}$ exists, then for all attainable time $T$ claims $X$, we will have 

$$
\Pi(t;X) = \mathbb{E}^\mathbb{P} \left[ \frac{X}{V^{\tilde\pi}_T/V^{\tilde\pi}_t} \Bigg| \mathcal{F}_t \right]
$$
from a trivial replicating argument.  At first, we must ask if this is even possible. We show that it is indeed possible, and we do this by constructing such a portfolio.



## Constructing the numeraire portfolio

We can try to find such a numeraire portfolio $\tilde{\pi}$, i.e. a portfolio such that $\left( V_t^\pi/V_t^{\tilde{\pi}} \right)_t$ is a $\mathbb{P}$ martingale for all portfolios $\pi$, by demanding that $d\left( V_t^\pi/V_t^{\tilde{\pi}} \right)$ is driftless. Equivalently, we require $\frac{d\left(V_t^\pi/V_t^{\tilde{\pi}} \right)}{V_t^\pi/V_t^{\tilde{\pi}}}$ is driftless. (Note this is the portfolio $\pi$'s return in units of $V_t^{\tilde{\pi}}$ which will be useful to compute. As a general trick, when working with a portfolio process, it is often easiest to work in terms of its return. When working with a ratio of assets, the ratio represents the price of one in terms of units of the other and thus itself represents a price process. When working with this new price process it is often useful to work in terms of its return.) 

Now let's construct the numeraire portfolio. We wish to find $\tilde{\pi}$ such that for all $\pi$, we have 

$$\frac{d\left(V_t^\pi/V_t^{\tilde{\pi}} \right)}{V_t^\pi/V_t^{\tilde{\pi}}}$$
is driftless. Hence $(V_t^\pi/V_t^{\tilde{\pi}})$ will be a $\mathbb{P}$ martingale.

First, by Ito's lemma, we have

$$\frac{d\left(V_t^\pi/V_t^{\tilde{\pi}} \right)}{V_t^\pi/V_t^{\tilde{\pi}}} = \frac{dV^\pi_t}{V^\pi_t} - \frac{dV^\tilde\pi_t}{V^\tilde\pi_t} +  \left(\frac{dV^\tilde\pi_t}{V^\tilde\pi_t} \right)^2 - \frac{dV^\tilde\pi_t dV^\pi_t}{V^\tilde\pi_t V^\pi_t}.$$

The surprising cleanliness of the above equation is due to the fact that we are working with a highly relevant quantity -- the return of one portfolio in units of another (or the relative return). Substituting for the portfolio returns and factoring, we have


$$\frac{d\left(V_t^\pi/V_t^{\tilde{\pi}} \right)}{V_t^\pi/V_t^{\tilde{\pi}}} = (\pi_t - \tilde{\pi}_t)^T \left((\mu_t - \vec{1}r_t) dt + \sigma_t dW_t - \sigma_t \sigma_t^T \tilde{\pi_t} dt\right) .$$

Thus it is driftless if and only if 

$$ (\pi_t - \tilde{\pi}_t)^T \left((\mu_t - \vec{1}r_t)  - \sigma_t \sigma_t^T \tilde{\pi_t}\right) = 0.$$

We need to find a $\tilde{\pi}$ such that the above holds for all $\pi$. This can be done for each $t$. Denote $x=\pi_t$, $y=\tilde{\pi}_t$, $b = (\mu_t - \vec{1}r_t)$ and $A = \sigma_t \sigma_t^T$. We note that by our original assumptions, $A$ is invertible.

We now have the problem find $y$ such that for all $x$ it holds:

$$
(x-y)^T(b-Ay) = 0.
$$
First, since $A$ is invertible, we can choose $y = A^{-1}b$ and we are done. However, one might wonder about uniqueness. This $y$ is infact unique as the above has to hold for all $x$. We can choose the particular choice $x = b - Ay + y$ which shows that $||b-Ay||^2 = 0$ and hence $y = A^{-1}b$ is the only solution. What this means is that

 $$\tilde{\pi}_t =  (\sigma_t \sigma_t^T)^{-1} (\mu_t - \vec{1}r_t)$$ 
 is the only numeraire portfolio.

This shows that when the problem is arbitrage free, there exists a unqiue numeraire portfolio $\tilde{\pi} =  (\sigma_t \sigma_t^T)^{-1}  (\mu_t - \vec{1}r_t)$. With this portfolio we have, $\left( V_t^\pi/V_t^{\tilde{\pi}} \right)_t$ is a $\mathbb{P}$ martingale for all portfolios $\pi$ which gives the relation of all portfolios:

$$
\frac{V^\pi_t}{V^{\tilde\pi}_t} = \mathbb{E}^\mathbb{P} \left[ \frac{V^\pi_T}{V^{\tilde\pi}_T} \Bigg| \mathcal{F}_t \right]
$$


and hence for all attainable claims
$$
\Pi(t;X) = \mathbb{E}^\mathbb{P} \left[ \frac{X}{V^{\tilde\pi}_T/V^{\tilde\pi}_t} \Bigg| \mathcal{F}_t \right].
$$
This portfolio turns out to be the log-optimal portfolio. This is easily seen as taking $V^\pi_0 = V^{\tilde\pi}_0$ (i.e. the portfolio values start with the same initial wealth), we have 

$$
1 = \mathbb{E}^\mathbb{P} \left[ \frac{V^\pi_T}{V^{\tilde\pi}_T} \right].
$$

Taking log and applying Jensen's inequality will give that 

$$
  \mathbb{E}^\mathbb{P} \left[\log(V^\pi_T)\right] \leq \mathbb{E}^\mathbb{P} \left[\log(V^{\tilde{\pi}}_T) \right], \quad \forall \pi,
$$
hence the numeraire portfolio is the log-optimal portfolio.

# A remark on non-uniqueness of the EMM

In our case, we have an incomplete market. However, we can price any attainable claim with one of the infinitely many EMMs $\mathbb{Q}$. Why then was the numeraire portfolio unique?

Indeed there are infinitely many EMM $\mathbb{Q}$, and hence there are infinitely many stochastic discount factors defined by  $m_T = \frac{d\mathbb{Q}}{d\mathbb{P}} \Big|_\mathcal{F_t} \frac{1}{B_T/B_t}$ that can be used as the SDF to price claims under $\mathbb{P}$. However only one out of these SDFs corresponds to an attainable portfolio. That is $\frac{d\mathbb{Q}}{d\mathbb{P}} \Big|_\mathcal{F_t} \frac{1}{B_T/B_t} = \frac{1}{V^{\tilde{\pi}}_T/V^{\tilde{\pi}}_t}$ for a unique $Q$ and only when $V^{\tilde{\pi}}$ is the log-optimal portfolio.

